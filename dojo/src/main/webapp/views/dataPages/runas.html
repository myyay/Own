<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;20.&nbsp;&#26367;&#25442;&#39564;&#35777;&#36523;&#20221;</title><link rel="stylesheet" href="html.css" tppabs="http://www.family168.com/tutorial/springsecurity/html/css/html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.72.0"><link rel="start" href="springsecurity.html" title="Spring Security"><link rel="up" href="authentication.html" title="Part&nbsp;III.&nbsp;&#35748;&#35777;"><link rel="prev" href="cas.html" title="Chapter&nbsp;19.&nbsp;CAS&#35748;&#35777;"><link rel="next" href="ca.html" title="Chapter&nbsp;21.&nbsp;&#23481;&#22120;&#36866;&#37197;&#22120;&#35748;&#35777;"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div xmlns:fo="http://www.w3.org/1999/XSL/Format" style="background-color:white;border:none;height:73px;border:1px solid black;"><a style="border:none;" href="javascript:if(confirm('http://static.springframework.org/spring-ws/site/  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://static.springframework.org/spring-ws/site/'" tppabs="http://static.springframework.org/spring-ws/site/" title="The Spring Framework - Spring Web Services"><img style="border:none;" src="xdev-spring_logo.jpg" tppabs="http://www.family168.com/tutorial/springsecurity/html/images/xdev-spring_logo.jpg"></a><a style="border:none;" href="javascript:if(confirm('http://www.springsource.com/  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://www.springsource.com/'" tppabs="http://www.springsource.com/" title="SpringSource"><img style="border:none;position:absolute;padding-top:5px;right:42px;" src="s2-banner-rhs.png" tppabs="http://www.family168.com/tutorial/springsecurity/html/images/s2-banner-rhs.png"></a></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h1 class="title"><a name="runas"></a>&#26367;&#25442;&#39564;&#35777;&#36523;&#20221;</h1></div></div></div>


    <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="runas-overview"></a>20.1.&nbsp;&#27010;&#36848;</h2></div></div></div>
        

        <p><code class="literal">AbstractSecurityInterceptor</code>&#21487;&#20197;&#22312;&#23433;&#20840;&#23545;&#35937;&#22238;&#35843;&#26399;&#38388;&#65292;&#26242;&#26102;&#26367;&#25442;<code class="literal">SecurityContext</code>&#21644;<code class="literal">SecurityContextHolder</code>&#37324;&#30340;<code class="literal">Authentication</code>&#23545;&#35937;&#12290;
            &#21482;&#26377;&#22312;&#21407;&#22987;<code class="literal">Authentication</code>&#23545;&#35937;&#34987;<code class="literal">AuthenticationManager</code>&#21644;<code class="literal">AccessDecisionManager</code>&#25104;&#21151;&#22788;&#29702;&#20043;&#21518;&#65292;&#25165;&#26377;&#21487;&#33021;&#21457;&#29983;&#36825;&#31181;&#24773;&#20917;&#12290;
            &#22914;&#26524;&#26377;&#38656;&#35201;&#65292;<code class="literal">RunAsManager</code>&#20250;&#26174;&#31034;&#26367;&#25442;&#30340;<code class="literal">Authentication</code>&#23545;&#35937;&#65292;&#36825;&#24212;&#35813;&#36890;&#36807;<code class="literal">SecurityInterceptorCallback</code>&#35843;&#29992;&#12290;</p>

        <p>&#36890;&#36807;&#22312;&#23433;&#20840;&#23545;&#35937;&#22238;&#35843;&#36807;&#31243;&#20013;&#20020;&#26102;&#26367;&#25442; <code class="literal">Authentication</code> &#23545;&#35937;&#65292;&#23433;&#20840;&#35843;&#29992;&#21487;&#20197;&#35843;&#29992;&#20854;&#20182;&#38656;&#35201;&#19981;&#21516;&#35748;&#35777;&#25480;&#26435;&#35777;&#20070;&#30340;&#23545;&#35937;&#12290;
            &#36825;&#20063;&#21487;&#20197;&#20026;&#29305;&#23450;&#30340;<code class="literal">GrantedAuthority</code>&#23545;&#35937;&#25191;&#34892;&#20869;&#37096;&#23433;&#20840;&#26816;&#39564;&#12290;
            &#22240;&#20026;Spring Security&#25552;&#20379;&#19981;&#23569;&#24110;&#21161;&#31867;&#65292;&#33021;&#22815;&#22522;&#20110;<code class="literal">SecurityContextHolder</code>&#30340;&#20869;&#23481;&#33258;&#21160;&#37197;&#32622;&#36828;&#31243;&#21327;&#35758;&#65292;&#36825;&#20123;&#36816;&#34892;&#36523;&#20221;&#26367;&#25442;&#22312;&#36828;&#31243;web&#26381;&#21153;&#35843;&#29992;&#30340;&#26102;&#20505;&#29305;&#21035;&#26377;&#29992;&#12290;</p>
    </div>

    <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="runas-config"></a>20.2.&nbsp;&#37197;&#32622;</h2></div></div></div>
        
        <p>&#19968;&#20010;Spring Security&#25552;&#20379;&#30340; <code class="literal">RunAsManager</code> &#25509;&#21475;&#65306;:
            </p><pre class="programlisting">
  Authentication buildRunAs(Authentication authentication, Object object, ConfigAttributeDefinition config);
  boolean supports(ConfigAttribute attribute);
  boolean supports(Class clazz);
            </pre><p>
        </p>

        <p>&#31532;&#19968;&#20010;&#26041;&#27861;&#36820;&#22238; <code class="literal">Authentication</code>&#23545;&#35937;&#65292;&#22312;&#26041;&#27861;&#30340;&#35843;&#29992;&#26399;&#38388;&#26367;&#25442;&#20197;&#21069;&#30340; <code class="literal">Authentication</code> &#23545;&#35937;&#12290;
            &#22914;&#26524;&#26041;&#27861;&#36820;&#22238;<code class="literal">null</code>&#65292;&#24847;&#21619;&#30528;&#19981;&#38656;&#35201;&#36827;&#34892;&#26367;&#25442;&#12290;
            &#31532;&#20108;&#20010;&#26041;&#27861;&#29992;&#22312;<code class="literal">AbstractSecurityInterceptor</code>&#20013;&#65292;&#20316;&#20026;&#23427;&#21551;&#21160;&#26102;&#26657;&#39564;&#37197;&#32622;&#23646;&#24615;&#30340;&#19968;&#37096;&#20998;&#12290;
            <code class="literal">supports(Class)</code>&#26041;&#27861;&#20250;&#34987;&#23433;&#20840;&#25318;&#25130;&#22120;&#30340;&#23454;&#29616;&#35843;&#29992;&#65292;&#30830;&#20445;&#37197;&#32622;&#30340;<code class="literal">RunAsManager</code>&#25903;&#25345;&#23433;&#20840;&#25318;&#25130;&#22120;&#21363;&#23558;&#25191;&#34892;&#30340;&#23433;&#20840;&#23545;&#35937;&#31867;&#22411;&#12290;</p>

        <p>Spring Security&#25552;&#20379;&#20102;&#19968;&#20010; <code class="literal">RunAsManager</code>&#30340;&#20855;&#20307;&#23454;&#29616;&#12290;
            &#22914;&#26524;&#20219;&#20309;&#19968;&#20010;<code class="literal">ConfigAttribute</code>&#26159;&#20197;<code class="literal">RUN_AS_</code>&#24320;&#22836;&#30340;&#65292;<code class="literal">RunAsManagerImpl</code>&#31867;&#36820;&#22238;&#19968;&#20010;&#26367;&#25442;&#30340;<code class="literal">RunAsUserToken</code>&#12290;
            &#22914;&#26524;&#25214;&#21040;&#20102;&#20219;&#20309;&#36825;&#26679;&#30340;<code class="literal">ConfigAttribute</code>&#65292;&#26367;&#25442;&#30340; <code class="literal">RunAsUserToken</code>&#20250;&#36890;&#36807;&#19968;&#20010;&#26032;&#30340;<code class="literal">GrantedAuthorityImpl</code>&#65292;&#20026;&#27599;&#19968;&#20010;<code class="literal">RUN_AS_</code> <code class="literal">ConfigAttribute</code>&#21253;&#21547;&#21516;&#26679;&#30340;&#20027;&#20307;&#65292;&#35777;&#20070;&#65292;&#36171;&#20104;&#30340;&#26435;&#38480;&#65292;&#23601;&#20687;&#21407;&#26469;&#30340;<code class="literal">Authentication</code>&#23545;&#35937;&#19968;&#26679;&#12290;
            &#27599;&#20010;&#26032; <code class="literal">GrantedAuthorityImpl</code> &#20250;&#20197;<code class="literal">ROLE_</code>&#24320;&#22836;&#65292;&#23545;&#24212;<code class="literal">RUN_AS</code> <code class="literal">ConfigAttribute</code>&#12290;
            &#27604;&#22914;&#65292;&#19968;&#20010;&#26367;&#20195;<code class="literal">RunAsUserToken</code>&#65292;&#23545;&#20110;<code class="literal">RUN_AS_SERVER</code>&#30340;&#32467;&#26524;&#26159;&#21253;&#21547;&#19968;&#20010;<code class="literal">ROLE_RUN_AS_SERVER</code>&#36171;&#20104;&#30340;&#26435;&#38480;&#12290;</p>

        <p>&#26367;&#20195;&#30340; <code class="literal">RunAsUserToken</code> &#23601;&#20687;&#20854;&#20182; <code class="literal">Authentication</code> &#23545;&#35937;&#19968;&#26679;&#12290;
            &#23427;&#21487;&#33021;&#38656;&#35201;&#36890;&#36807;&#20195;&#29702;&#21512;&#36866;&#30340;<code class="literal">AuthenticationProvider</code>&#34987;<code class="literal">AuthenticationManager</code>&#39564;&#35777;&#12290;
            &#36825;&#20010;<code class="literal">RunAsImplAuthenticationProvider</code>&#25191;&#34892;&#36825;&#26679;&#30340;&#35748;&#35777;&#65292;&#23427;&#30452;&#25509;&#33719;&#24471;&#20219;&#20309;&#19968;&#20010;&#26377;&#25928;&#30340;<code class="literal">RunAsUserToken</code>&#12290;</p>

        <p>&#20026;&#20102;&#20445;&#35777;&#24694;&#24847;&#20195;&#30721;&#19981;&#20250;&#21019;&#24314;&#19968;&#20010;<code class="literal">RunAsUserToken</code>&#65292;&#30001;<code class="literal">RunAsImplAuthenticationProvider</code>&#20445;&#38556;&#33719;&#24471;&#19968;&#20010;key&#30340;&#25955;&#21015;&#20540;&#34987;&#20445;&#23384;&#22312;&#25152;&#26377;&#29983;&#25104;&#30340;&#26631;&#35760;&#37324;&#12290;
            <code class="literal">RunAsManagerImpl</code>&#21644;<code class="literal">RunAsImplAuthenticationProvider</code>&#22312;bean&#19978;&#19979;&#25991;&#37324;&#65292;&#21019;&#24314;&#20351;&#29992;&#21516;&#26679;&#30340;key&#65306;
            </p><pre class="programlisting">

&lt;bean id="runAsManager" class="org.springframework.security.runas.RunAsManagerImpl"&gt;
  &lt;property name="key" value="my_run_as_password"/&gt;
&lt;/bean&gt;

&lt;bean id="runAsAuthenticationProvider"
    class="org.springframework.security.runas.RunAsImplAuthenticationProvider"&gt;
  &lt;property name="key" value="my_run_as_password"/&gt;
&lt;/bean&gt;</pre>
        <p>&#36890;&#36807;&#20351;&#29992;&#30456;&#21516;&#30340;key&#65292;&#27599;&#20010;<code class="literal">RunAsUserToken</code>&#21487;&#20197;&#34987;&#23427;&#39564;&#35777;&#65292;&#24182;&#20351;&#29992;&#23545;&#24212;&#30340;<code class="literal">RunAsManagerImpl</code>&#21019;&#24314;&#12290;
            &#20986;&#20110;&#23433;&#20840;&#21407;&#22240;&#65292;&#36825;&#20010;<code class="literal">RunAsUserToken</code>&#21019;&#24314;&#21518;&#23601;&#19981;&#33021;&#25913;&#21464;&#12290;</p>
    </div>
</div><div xmlns:fo="http://www.w3.org/1999/XSL/Format" class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="cas.html" tppabs="http://www.family168.com/tutorial/springsecurity/html/cas.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="springsecurity.html" tppabs="http://www.family168.com/tutorial/springsecurity/html/springsecurity.html">Home</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="ca.html" tppabs="http://www.family168.com/tutorial/springsecurity/html/ca.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;19.&nbsp;CAS&#35748;&#35777;&nbsp;</td><td width="20%" align="center"><span style="color:white;font-size:90%;"><a href="javascript:if(confirm('http://www.springsource.com/  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://www.springsource.com/'" tppabs="http://www.springsource.com/" title="SpringSource">Sponsored by SpringSource
                                        </a></span></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;21.&nbsp;&#23481;&#22120;&#36866;&#37197;&#22120;&#35748;&#35777;</td></tr></table></div></body></html><script type="text/javascript">var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www./");document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));</script><script type="text/javascript">var pageTracker = _gat._getTracker("UA-2857097-3");pageTracker._initData();pageTracker._trackPageview();</script>