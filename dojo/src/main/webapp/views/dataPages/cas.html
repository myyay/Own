<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;19.&nbsp;CAS&#35748;&#35777;</title><link rel="stylesheet" href="html.css" tppabs="http://www.family168.com/tutorial/springsecurity/html/css/html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.72.0"><link rel="start" href="springsecurity.html" title="Spring Security"><link rel="up" href="authentication.html" title="Part&nbsp;III.&nbsp;&#35748;&#35777;"><link rel="prev" href="x509.html" title="Chapter&nbsp;18.&nbsp;X.509&#35748;&#35777;"><link rel="next" href="runas.html" title="Chapter&nbsp;20.&nbsp;&#26367;&#25442;&#39564;&#35777;&#36523;&#20221;"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div xmlns:fo="http://www.w3.org/1999/XSL/Format" style="background-color:white;border:none;height:73px;border:1px solid black;"><a style="border:none;" href="javascript:if(confirm('http://static.springframework.org/spring-ws/site/  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://static.springframework.org/spring-ws/site/'" tppabs="http://static.springframework.org/spring-ws/site/" title="The Spring Framework - Spring Web Services"><img style="border:none;" src="xdev-spring_logo.jpg" tppabs="http://www.family168.com/tutorial/springsecurity/html/images/xdev-spring_logo.jpg"></a><a style="border:none;" href="javascript:if(confirm('http://www.springsource.com/  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://www.springsource.com/'" tppabs="http://www.springsource.com/" title="SpringSource"><img style="border:none;position:absolute;padding-top:5px;right:42px;" src="s2-banner-rhs.png" tppabs="http://www.family168.com/tutorial/springsecurity/html/images/s2-banner-rhs.png"></a></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="cas"></a>Chapter&nbsp;19.&nbsp;CAS&#35748;&#35777;</h2></div></div></div>

  

  <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cas-overview"></a>19.1.&nbsp;&#27010;&#36848;</h2></div></div></div>
    

    <p>JA-SIG&#24320;&#21457;&#20102;&#19968;&#20010;&#20225;&#19994;&#32423;&#30340;&#21333;&#28857;&#30331;&#24405;&#31995;&#32479;&#65292;&#21483;&#20570;CAS&#12290;
    &#19982;&#20854;&#20182;&#39033;&#30446;&#19981;&#21516;&#65292;JA-SIG&#30340;&#20013;&#24515;&#35748;&#35777;&#26381;&#21153;&#26159;&#24320;&#28304;&#30340;&#65292;&#24191;&#27867;&#20351;&#29992;&#30340;&#65292;&#31616;&#21333;&#29702;&#35299;&#30340;&#65292;&#19981;&#20381;&#36182;&#24179;&#21488;&#30340;&#65292;&#32780;&#19988;&#25903;&#25345;&#20195;&#29702;&#33021;&#21147;&#12290;
    Spring Security&#23436;&#20840;&#25903;&#25345;CAS&#65292;&#25552;&#20379;&#19968;&#20010;&#31616;&#21333;&#30340;&#25972;&#21512;&#26041;&#24335;&#65292;&#25226;&#20351;&#29992;Spring Security&#30340;&#21333;&#24212;&#29992;&#21457;&#24067;&#65292;&#36716;&#25442;&#25104;&#20351;&#29992;&#20225;&#19994;&#32423;CAS&#26381;&#21153;&#22120;&#30340;&#22810;&#24212;&#29992;&#21457;&#24067;&#23433;&#20840;</p>

    <p>&#20320;&#21487;&#20197;&#20174;<code class="literal">http://www.ja-sig.org/products/cas/</code>&#25214;&#21040;CAS&#30340;&#26356;&#22810;&#20449;&#24687;&#12290;
    &#20320;&#36824;&#38656;&#35201;&#35775;&#38382;&#36825;&#20010;&#32593;&#31449;&#19979;&#36733;CAS&#26381;&#21153;&#22120;&#25991;&#20214;&#12290;</p>
  </div>

  <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cas-how-it-works"></a>19.2.&nbsp;CAS&#26159;&#22914;&#20309;&#24037;&#20316;&#30340;</h2></div></div></div>
    

    <p>&#34429;&#28982;CAS&#32593;&#31449;&#21253;&#21547;&#20102;CAS&#30340;&#26550;&#26500;&#25991;&#26723;&#65292;&#25105;&#20204;&#36825;&#37324;&#36824;&#26159;&#35828;&#19968;&#19979;&#20351;&#29992;Spring Security&#29615;&#22659;&#30340;&#19968;&#33324;&#24615;&#27010;&#36848;&#65292;&#12290;
    Spring Security 2.0&#25903;&#25345;CAS 3&#12290;
    &#22312;&#20889;&#25991;&#26723;&#30340;&#26102;&#20505;&#65292;CAS&#26381;&#21153;&#22120;&#30340;&#29256;&#26412;&#26159;3.2&#12290;</p>

    <p>&#20320;&#35201;&#22312;&#20844;&#21496;&#20869;&#37096;&#23433;&#35013;CAS&#26381;&#21153;&#22120;&#12290;
    CAS&#26381;&#21153;&#22120;&#23601;&#26159;&#19968;&#20010;WAR&#25991;&#20214;&#65292;&#25152;&#20197;&#23433;&#35013;&#26381;&#21153;&#22120;&#27809;&#26377;&#20160;&#20040;&#38590;&#30340;&#12290;
    &#22312;WAR&#25991;&#20214;&#37324;&#65292;&#20320;&#38656;&#35201;&#33258;&#23450;&#20041;&#30331;&#24405;&#21644;&#20854;&#20182;&#21333;&#28857;&#30331;&#24405;&#23637;&#31034;&#32473;&#29992;&#25143;&#30340;&#39029;&#38754;&#12290;</p>

    <p>&#21457;&#24067;CAS 3.2&#30340;&#26102;&#20505;&#65292;&#20320;&#20063;&#38656;&#35201;&#25351;&#23450;&#19968;&#20010;CAS&#30340;<code class="filename">deployerConfigContext.xml</code>&#37324;&#21253;&#21547;&#30340;<code class="literal">AuthenticationHandler</code>&#12290;
    <code class="literal">AuthenticationHandler</code>&#26377;&#19968;&#20010;&#31616;&#21333;&#30340;&#26041;&#27861;&#65292;&#36820;&#22238;&#24067;&#23572;&#20540;&#65292;&#21028;&#26029;&#32473;&#20986;&#30340;&#35777;&#20070;&#38598;&#21512;&#26159;&#21542;&#26377;&#25928;&#12290;
    &#20320;&#30340;<code class="literal">AuthenticationHandler</code>&#23454;&#29616;&#20250;&#38656;&#35201;&#38142;&#25509;&#21040;&#21518;&#21488;&#35748;&#35777;&#36164;&#28304;&#31867;&#22411;&#37324;&#65292;&#20687;&#26159;LDAP&#26381;&#21153;&#22120;&#25110;&#25968;&#25454;&#24211;&#12290;
    CAS&#33258;&#24049;&#20063;&#21253;&#21547;&#38750;&#24120;&#22810;<code class="literal">AuthenticationHandler</code>&#24110;&#21161;&#23454;&#29616;&#36825;&#20123;&#12290;
    &#22312;&#20320;&#19979;&#36733;&#21457;&#24067;&#26381;&#21153;&#22120;war&#25991;&#20214;&#30340;&#26102;&#20505;&#65292;&#23427;&#20250;&#25226;&#29992;&#25143;&#21517;&#21644;&#23494;&#30721;&#21305;&#37197;&#30340;&#29992;&#25143;&#25104;&#21151;&#39564;&#35777;&#65292;&#36825;&#23545;&#27979;&#35797;&#24456;&#26377;&#29992;&#12290;</p>

    <p>&#38500;&#20102;CAS&#26381;&#21153;&#22120;&#65292;&#20854;&#20182;&#20851;&#38190;&#35282;&#33394;&#24403;&#28982;&#26159;&#20320;&#20225;&#19994;&#21457;&#24067;&#30340;&#20854;&#20182;&#23433;&#20840;web&#24212;&#29992;&#12290;
    &#36825;&#20123;web&#24212;&#29992;&#34987;&#21483;&#20570;"services"&#12290;
    &#36825;&#20799;&#26377;&#20004;&#31181;&#26381;&#21153;&#65306;&#26631;&#20934;&#26381;&#21153;&#21644;&#20195;&#29702;&#26381;&#21153;&#12290;
    &#20195;&#29702;&#26381;&#21153;&#21487;&#20197;&#20195;&#34920;&#29992;&#25143;&#65292;&#20174;&#20854;&#20182;&#26381;&#21153;&#20013;&#35831;&#27714;&#36164;&#28304;&#12290;
    &#21518;&#38754;&#20250;&#36827;&#34892;&#26356;&#35814;&#32454;&#30340;&#20171;&#32461;&#12290;</p>


  </div>

  <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cas-client"></a>19.3.&nbsp;&#37197;&#32622;CAS&#23458;&#25143;&#31471;</h2></div></div></div>
    

    <p>CAS&#30340;web&#24212;&#29992;&#31471;&#36890;&#36807;Spring Security&#20351;&#29992;&#36215;&#26469;&#24456;&#31616;&#21333;&#12290;
    &#25105;&#20204;&#20551;&#35774;&#20320;&#24050;&#32463;&#30693;&#36947;Spring Security&#30340;&#22522;&#26412;&#29992;&#27861;&#65292;&#25152;&#20197;&#19979;&#38754;&#37117;&#27809;&#26377;&#28041;&#21450;&#36825;&#20123;&#12290;
    &#25105;&#20204;&#20250;&#20551;&#35774;&#20351;&#29992;&#22522;&#20110;&#21629;&#21517;&#31354;&#38388;&#37197;&#32622;&#30340;&#26041;&#27861;&#65292;&#24182;&#19988;&#28155;&#21152;&#20102;CAS&#38656;&#35201;&#30340;bean&#12290;
    </p>

    <p>&#20320;&#38656;&#35201;&#28155;&#21152;&#19968;&#20010; <code class="literal">ServiceProperties</code> bean&#65292;&#21040;&#20320;&#30340;application context&#37324;&#12290;
    &#36825;&#34920;&#29616;&#20320;&#30340;&#26381;&#21153;&#65306;</p>

    <pre class="programlisting">
  &lt;bean id="serviceProperties" class="org.springframework.security.ui.cas.ServiceProperties"&gt;
    &lt;property name="service" value="https://localhost:8443/cas-sample/j_spring_cas_security_check"/&gt;
    &lt;property name="sendRenew" value="false"/&gt;
  &lt;/bean&gt;
    </pre>

    <p>&#36825;&#37324;&#30340;<code class="literal">service</code>&#24517;&#39035;&#26159;&#19968;&#20010;&#30001;<code class="literal">CasProcessingFilter</code>&#30417;&#25511;&#30340;URL&#12290;
    &#36825;&#20010;<code class="literal">sendRenew</code>&#40664;&#35748;&#26159;false&#65292;&#20294;&#22914;&#26524;&#20320;&#30340;&#31243;&#24207;&#29305;&#21035;&#25935;&#24863;&#23601;&#24212;&#35813;&#35774;&#32622;&#25104;true&#12290;
    &#36825;&#20010;&#21442;&#25968;&#20316;&#29992;&#26159;&#65292;&#21578;&#35785;CAS&#30331;&#24405;&#26381;&#21153;&#65292;&#19968;&#20010;&#21333;&#28857;&#30331;&#24405;&#27809;&#26377;&#21040;&#36798;&#12290;
    &#21542;&#21017;&#65292;&#29992;&#25143;&#38656;&#35201;&#37325;&#26032;&#36755;&#20837;&#20182;&#20204;&#30340;&#29992;&#25143;&#21517;&#21644;&#23494;&#30721;&#65292;&#26469;&#33719;&#24471;&#35775;&#38382;&#26381;&#21153;&#30340;&#26435;&#38480;&#12290;</p>

    <p>&#19979;&#38754;&#37197;&#32622;&#30340;bean&#23601;&#26159;&#23637;&#24320;CAS&#35748;&#35777;&#30340;&#36807;&#31243;&#65306;</p>

    <pre class="programlisting">
&lt;security:authentication-manager alias="authenticationManager"/&gt;

&lt;bean id="casProcessingFilter" class="org.springframework.security.ui.cas.CasProcessingFilter"&gt;
  &lt;security:custom-filter after="CAS_PROCESSING_FILTER"/&gt;
  &lt;property name="authenticationManager" ref="authenticationManager"/&gt;
  &lt;property name="authenticationFailureUrl" value="/casfailed.jsp"/&gt;
  &lt;property name="defaultTargetUrl" value="/"/&gt;
&lt;/bean&gt;

&lt;bean id="casProcessingFilterEntryPoint"
    class="org.springframework.security.ui.cas.CasProcessingFilterEntryPoint"&gt;
  &lt;property name="loginUrl" value="https://localhost:9443/cas/login"/&gt;
  &lt;property name="serviceProperties" ref="serviceProperties"/&gt;
&lt;/bean&gt;


    </pre>

    <p>
      &#24212;&#35813;&#20351;&#29992; <a xmlns:xlink="http://www.w3.org/1999/xlink" href="javascript:if(confirm('http://www.family168.com/tutorial/springsecurity/html/ns-entry-point-ref  \n\n该文件无法用 Teleport Ultra 下载, 因为 服务器报告该文件未找到。  \n\n你想在服务器上打开它?'))window.location='http://www.family168.com/tutorial/springsecurity/html/ns-entry-point-ref'" tppabs="http://www.family168.com/tutorial/springsecurity/html/ns-entry-point-ref" target="_top"><code class="literal">entry-point-ref</code></a>&#36873;&#25321;&#39537;&#21160;&#35748;&#35777;&#30340;<code class="classname">CasProcessingFilterEntryPoint</code>&#31867;&#12290;
    </p>

    <p><code class="literal">CasProcessingFilter</code>&#30340;&#23646;&#24615;&#19982; <code class="literal">AuthenticationProcessingFilter</code>&#38750;&#24120;&#30456;&#20284;&#65288;&#22312;&#22522;&#20110;&#34920;&#21333;&#30331;&#24405;&#26102;&#29992;&#21040;&#65289;&#12290;
    &#27599;&#20010;&#23646;&#24615;&#20174;&#23383;&#38754;&#19978;&#37117;&#24456;&#22909;&#29702;&#35299;&#12290;
    &#27880;&#24847;&#25105;&#20204;&#20063;&#20351;&#29992;&#21629;&#21517;&#31354;&#38388;&#35821;&#27861;&#65292;&#20026;&#35748;&#35777;&#31649;&#29702;&#22120;&#35774;&#32622;&#19968;&#20010;&#21035;&#21517;&#65292;&#36825;&#26679;<code class="literal">CasProcessingFilter</code>&#38656;&#35201;&#23427;&#30340;&#19968;&#20010;&#24341;&#29992;&#12290;</p>

    <p>&#20026;&#20102;CAS&#30340;&#25805;&#20316;&#65292;<code class="literal">ExceptionTranslationFilter</code>&#24517;&#39035;&#26377;&#23427;&#30340;<code class="literal">authenticationEntryPoint</code>&#65292;&#36825;&#37324;&#35774;&#32622;&#25104;<code class="literal">CasProcessingFilterEntryPoint</code> bean&#12290;</p>

    <p><code class="literal">CasProcessingFilterEntryPoint</code> &#24517;&#39035;&#25351;&#21521; <code class="literal">ServiceProperties</code> bean &#65288;&#19978;&#38754;&#35752;&#35770;&#36807;&#20102;&#65289;&#65292;&#23427;&#20026;&#20225;&#19994;CAS&#30331;&#24405;&#26381;&#21153;&#22120;&#25552;&#20379;URL&#12290;
    &#36825;&#26159;&#29992;&#25143;&#27983;&#35272;&#22120;&#23558;&#34987;&#37325;&#23450;&#21521;&#30340;&#20301;&#32622;&#12290;</p>

    <p>&#19979;&#19968;&#27493;&#65292;&#20320;&#38656;&#35201;&#28155;&#21152;&#19968;&#20010;<code class="literal">CasAuthenticationProvider</code> &#21644;&#23427;&#30340;&#21512;&#20316;&#20249;&#20276;&#65306;
      </p><pre class="programlisting">
  &lt;bean id="casAuthenticationProvider" class="org.springframework.security.providers.cas.CasAuthenticationProvider"&gt;
    &lt;security:custom-authentication-provider /&gt;
    &lt;property name="userDetailsService" ref="userService"/&gt;
    &lt;property name="serviceProperties" ref="serviceProperties" /&gt;
    &lt;property name="ticketValidator"&gt;
      &lt;bean class="org.jasig.cas.client.validation.Cas20ServiceTicketValidator"&gt;
        &lt;constructor-arg index="0" value="https://localhost:9443/cas" /&gt;
        &lt;/bean&gt;
    &lt;/property&gt;
    &lt;property name="key" value="an_id_for_this_auth_provider_only"/&gt;
  &lt;/bean&gt;

  &lt;security:user-service id="userService"&gt;
    &lt;security:user name="joe" password="joe" authorities="ROLE_USER" /&gt;
    ...
  &lt;/security:user-service&gt;
      </pre><p>
      <code class="classname">&#19968;&#26086;&#36890;&#36807;&#20102;CAS&#30340;&#35748;&#35777;&#65292;CasAuthenticationProvider</code> &#20351;&#29992;&#19968;&#20010; <code class="interfacename">UserDetailsService</code>&#23454;&#20363;&#65292;&#26469;&#21152;&#36733;&#29992;&#25143;&#30340;&#35748;&#35777;&#20449;&#24687;&#12290;
      &#36825;&#37324;&#25105;&#20204;&#23637;&#31034;&#19968;&#20010;&#31616;&#21333;&#30340;&#22522;&#20110;&#20869;&#23384;&#30340;&#35774;&#32622;&#12290;
    </p>

    <p>&#22914;&#26524;&#20320;&#32763;&#22238;&#22836;&#30475;&#19968;&#19979;"How CAS Works"&#37027;&#33410;&#65292;&#36825;&#20123;beans&#37117;&#26159;&#20174;&#21517;&#23383;&#23601;&#21487;&#20197;&#30475;&#25026;&#30340;&#12290;</p>
  </div>

</div><div xmlns:fo="http://www.w3.org/1999/XSL/Format" class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="x509.html" tppabs="http://www.family168.com/tutorial/springsecurity/html/x509.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="springsecurity.html" tppabs="http://www.family168.com/tutorial/springsecurity/html/springsecurity.html">Home</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="runas.html" tppabs="http://www.family168.com/tutorial/springsecurity/html/runas.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;18.&nbsp;X.509&#35748;&#35777;&nbsp;</td><td width="20%" align="center"><span style="color:white;font-size:90%;"><a href="javascript:if(confirm('http://www.springsource.com/  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://www.springsource.com/'" tppabs="http://www.springsource.com/" title="SpringSource">Sponsored by SpringSource
                                        </a></span></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;20.&nbsp;&#26367;&#25442;&#39564;&#35777;&#36523;&#20221;</td></tr></table></div></body></html><script type="text/javascript">var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www./");document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));</script><script type="text/javascript">var pageTracker = _gat._getTracker("UA-2857097-3");pageTracker._initData();pageTracker._trackPageview();</script>