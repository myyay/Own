<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;7.&nbsp;&#20449;&#36947;&#23433;&#20840;</title><link rel="stylesheet" href="html.css" tppabs="http://www.family168.com/tutorial/springsecurity/html/css/html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.72.0"><link rel="start" href="springsecurity.html" title="Spring Security"><link rel="up" href="overall-architecture.html" title="Part&nbsp;II.&nbsp;&#24635;&#20307;&#32467;&#26500;"><link rel="prev" href="supporting-infrastructure.html" title="Chapter&nbsp;6.&nbsp;&#25903;&#25345;&#30340;&#22522;&#30784;&#35774;&#26045;"><link rel="next" href="authentication.html" title="Part&nbsp;III.&nbsp;&#35748;&#35777;"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div xmlns:fo="http://www.w3.org/1999/XSL/Format" style="background-color:white;border:none;height:73px;border:1px solid black;"><a style="border:none;" href="javascript:if(confirm('http://static.springframework.org/spring-ws/site/  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://static.springframework.org/spring-ws/site/'" tppabs="http://static.springframework.org/spring-ws/site/" title="The Spring Framework - Spring Web Services"><img style="border:none;" src="xdev-spring_logo.jpg" tppabs="http://www.family168.com/tutorial/springsecurity/html/images/xdev-spring_logo.jpg"></a><a style="border:none;" href="javascript:if(confirm('http://www.springsource.com/  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://www.springsource.com/'" tppabs="http://www.springsource.com/" title="SpringSource"><img style="border:none;position:absolute;padding-top:5px;right:42px;" src="s2-banner-rhs.png" tppabs="http://www.family168.com/tutorial/springsecurity/html/images/s2-banner-rhs.png"></a></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h1 class="title"><a name="channel-security"></a>&#20449;&#36947;&#23433;&#20840;</h1></div></div></div>



<div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="channel-security-overview"></a>7.1.&nbsp;&#24635;&#36848;</h2></div></div></div>
    

    <p>&#20026;&#20102;&#22312;&#20320;&#30340;&#31243;&#24207;&#20013;&#21327;&#35843;&#35748;&#35777;&#19982;&#39564;&#35777;&#30340;&#35201;&#27714;&#65292;Spring Security&#20063;&#21487;&#20197;&#35753;&#26410;&#35748;&#35777;&#30340;web&#35831;&#27714;&#25658;&#24102;&#19968;&#20123;&#23646;&#24615;&#12290;
      &#36825;&#20123;&#23646;&#24615;&#21487;&#33021;&#21253;&#25324;&#29305;&#23450;&#30340;&#20256;&#36755;&#31867;&#22411;&#65292;&#25317;&#26377;&#29305;&#23450;&#30340; <code class="literal">HttpSession</code> &#23646;&#24615;&#35774;&#32622;&#65292;&#25110;&#20854;&#20182;&#12290;
      &#26368;&#24120;&#35265;&#30340;&#38656;&#27714;&#26159;&#65292;&#35753;&#20320;&#30340;web&#35831;&#27714;&#20351;&#29992;&#29305;&#23450;&#30340;&#20256;&#36755;&#21327;&#35758;&#21457;&#36865;&#65292;&#27604;&#22914;HTTPS&#12290;</p>

    <p>&#23041;&#32961;&#20256;&#36755;&#23433;&#20840;&#30340;&#19968;&#20010;&#37325;&#35201;&#22240;&#32032;&#26159;&#20250;&#35805;&#21163;&#25345;&#12290;&#20320;&#30340;web&#23481;&#22120;&#36890;&#36807;&#29992;&#25143;&#20195;&#29702;&#21457;&#36865;cookie&#25110;URL&#37325;&#20889;&#65292;&#20351;&#29992;<code class="literal">jsessionid</code>&#65292;&#26469;&#31649;&#29702;<code class="literal">HttpSession</code>&#12290;
    &#22914;&#26524;<code class="literal">jsessionid</code>&#20351;&#29992;HTTP&#21457;&#36865;&#65292;&#20250;&#35805;&#26631;&#35782;&#31526;&#24456;&#21487;&#33021;&#22312;&#29992;&#25143;&#36890;&#36807;&#39564;&#35777;&#36807;&#21518;&#65292;&#34987;&#20854;&#20182;&#20154;&#25318;&#25130;&#65292;&#20877;&#21435;&#27169;&#25311;&#29992;&#25143;&#35775;&#38382;&#12290;
    &#36825;&#26159;&#22240;&#20026;&#22823;&#22810;&#25968;web&#23481;&#22120;&#65292;&#20026;&#32473;&#23450;&#30340;&#29992;&#25143;&#32500;&#25252;&#30456;&#21516;&#30340;session&#26631;&#35782;&#31526;&#65292;&#21363;&#20351;&#20182;&#20204;&#20174;HTTP&#36716;&#25442;&#21040;HTTPS&#39029;&#38754;&#20063;&#19981;&#20250;&#25913;&#21464;&#12290;</p>

    <p>&#22914;&#26524;&#20250;&#35805;&#21163;&#25345;&#22312;&#20320;&#30340;&#29305;&#23450;&#31243;&#24207;&#37324;&#34987;&#35748;&#20026;&#26159;&#19968;&#20010;&#29305;&#21035;&#20540;&#24471;&#20851;&#27880;&#30340;&#23041;&#32961;&#65292;&#21807;&#19968;&#30340;&#35299;&#20915;&#26041;&#24335;&#23601;&#26159;&#22312;&#27599;&#20010;&#35831;&#27714;&#37324;&#37117;&#20351;&#29992;HTTPS&#12290;
        &#36825;&#24847;&#21619;&#30528;<code class="literal">jsessionid</code>&#20877;&#20063;&#19981;&#20250;&#36890;&#36807;&#19981;&#23433;&#20840;&#30340;&#36890;&#36947;&#12290;
        &#20320;&#20250;&#38656;&#35201;&#30830;&#35748;&#20320;&#30340;<code class="literal">web.xml</code>&#23450;&#20041;&#30340;<code class="literal">&lt;welcome-file&gt;</code>&#25351;&#21521;HTTPS&#20301;&#32622;&#12290;
        Spring Security&#22312;&#21518;&#38754;&#25552;&#20379;&#19968;&#20010;&#26041;&#27861;&#26469;&#24110;&#21161;&#23454;&#29616;&#36825;&#20123;&#21151;&#33021;&#12290;</p>
</div>

<div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="channel-security-config"></a>7.2.&nbsp;&#37197;&#32622;</h2></div></div></div>
    
    <p>&#20449;&#36947;&#23433;&#20840;&#24050;&#22312;<a href="ns-config.html#ns-requires-channel" tppabs="http://www.family168.com/tutorial/springsecurity/html/ns-config.html#ns-requires-channel" title="2.3.2.&nbsp;&#28155;&#21152;HTTP/HTTPS&#20449;&#36947;&#23433;&#20840;">&#23433;&#20840;&#21629;&#21517;&#31354;&#38388;</a>&#33719;&#24471;&#25903;&#25345;&#65292;
        &#20351;&#29992;<code class="literal">&lt;intercept-url&gt;</code>&#20803;&#32032;&#37324;&#30340;<code class="literal">requires-channel</code>&#23646;&#24615;&#65292;&#23601;&#33021;&#24456;&#31616;&#21333;&#23454;&#29616;&#65288;&#20063;&#25512;&#33616;&#36825;&#26679;&#20570;&#65289;&#12290;</p>
    <p>&#20026;&#20102;&#26126;&#30830;&#37197;&#32622;&#20449;&#36947;&#23433;&#20840;&#20320;&#38656;&#35201;&#22312;&#20320;&#30340;application context&#20013;&#23450;&#20041;&#19979;&#38754;&#30340;&#36807;&#28388;&#22120;&#65306;

</p><pre class="programlisting">
&lt;bean id="channelProcessingFilter" class="org.springframework.security.securechannel.ChannelProcessingFilter"&gt;
  &lt;property name="channelDecisionManager" ref="channelDecisionManager"/&gt;
  &lt;property name="filterInvocationDefinitionSource"&gt;
    &lt;security:filter-invocation-definition-source path-type="regex"&gt;
      &lt;security:intercept-url pattern="\A/secure/.*\Z" access="REQUIRES_SECURE_CHANNEL"/&gt;
      &lt;security:intercept-url pattern="\A/acegilogin.jsp.*\Z" access="REQUIRES_SECURE_CHANNEL"/&gt;
      &lt;security:intercept-url pattern="\A/j_spring_security_check.*\Z" access="REQUIRES_SECURE_CHANNEL"/&gt;
      &lt;security:intercept-url pattern="\A/.*\Z" access="ANY_CHANNEL"/&gt;
    &lt;/security:filter-invocation-definition-source&gt;
  &lt;/property&gt;
&lt;/bean&gt;

&lt;bean id="channelDecisionManager" class="org.springframework.security.securechannel.ChannelDecisionManagerImpl"&gt;
  &lt;property name="channelProcessors"&gt;
    &lt;list&gt;
    &lt;ref bean="secureChannelProcessor"/&gt;
    &lt;ref bean="insecureChannelProcessor"/&gt;
    &lt;/list&gt;
  &lt;/property&gt;
&lt;/bean&gt;

&lt;bean id="secureChannelProcessor" class="org.springframework.security.securechannel.SecureChannelProcessor"/&gt;
&lt;bean id="insecureChannelProcessor" class="org.springframework.security.securechannel.InsecureChannelProcessor"/&gt;
</pre><p>

    &#21644; <code class="literal">FilterSecurityInterceptor</code> &#19968;&#26679;&#65292;<code class="literal">ChannelProcessingFilter</code>&#20063;&#25903;&#25345;Apache Ant&#26679;&#24335;&#30340;&#36335;&#24452;&#12290;</p>

    <p>&#36825;&#20010; <code class="literal">ChannelProcessingFilter</code> &#36890;&#36807;&#36807;&#28388;&#25152;&#26377;&#30340;web&#35831;&#27714;&#65292;&#20915;&#23450;&#24212;&#29992;&#37197;&#32622;&#23646;&#24615;&#12290;
        &#23427;&#23558;&#20195;&#29702;<code class="literal">ChannelDecisionManager</code>&#12290;
        &#40664;&#35748;&#23454;&#29616;<code class="literal">ChannelDecisionManagerImpl</code>&#65292;&#24212;&#35813;&#28085;&#30422;&#20102;&#22823;&#22810;&#25968;&#24773;&#20917;&#12290;
        &#23427;&#30452;&#25509;&#35843;&#29992;&#37197;&#32622;&#30340;<code class="literal">ChannelProcessor</code>&#23454;&#20363;&#12290;
        <code class="literal">ANY_CHANNEL</code>&#23646;&#24615;&#21487;&#20197;&#29992;&#26469;&#35206;&#30422;&#36825;&#31181;&#34892;&#20026;&#65292;&#24573;&#30053;&#25351;&#23450;&#30340;URL&#12290;
        &#21542;&#21017;&#65292;&#19968;&#20010;<code class="literal">ChannelProcessor</code>&#20250;&#37325;&#26032;&#26816;&#26597;&#35831;&#27714;&#65292;&#22914;&#26524;&#35831;&#27714;&#19981;&#31526;&#21512;&#65288;&#27604;&#22914;&#65292;&#23427;&#21457;&#36865;&#25968;&#25454;&#20351;&#29992;&#20102;&#38169;&#35823;&#30340;&#20256;&#36755;&#21327;&#35758;&#65289;&#65292;&#23601;&#20250;&#25191;&#34892;&#19968;&#20010;&#37325;&#23450;&#21521;&#65292;&#25243;&#20986;&#19968;&#20010;&#24322;&#24120;&#65292;&#25110;&#25191;&#34892;&#38656;&#35201;&#30340;&#20219;&#20309;&#19968;&#20010;&#25805;&#20316;&#12290;</p>

    <p>Spring Security&#37324;&#21253;&#21547;&#20004;&#20010;&#20855;&#20307;<code class="literal">ChannelProcessor</code>&#23454;&#29616;&#65306;
        <code class="literal">SecureChannelProcessor</code> &#30830;&#20445;&#23545;&#24212;&#37197;&#32622;<code class="literal">REQUIRES_SECURE_CHANNEL</code>&#23646;&#24615;&#30340;&#35831;&#27714;&#20351;&#29992;HTTPS&#21457;&#36865;&#25968;&#25454;&#12290;
        <code class="literal">InsecureChannelProcessor</code> &#30830;&#20445;&#23545;&#24212;&#37197;&#32622;<code class="literal">REQUIRES_INSECURE_CHANNEL</code>&#23646;&#24615;&#30340;&#35831;&#27714;&#20351;&#29992;HTTP&#21457;&#36865;&#25968;&#25454;&#12290;
        &#22914;&#26524;&#27809;&#26377;&#20351;&#29992;&#23545;&#24212;&#30340;&#20256;&#36755;&#21327;&#35758;&#65292;&#36825;&#20004;&#20010;&#23454;&#29616;&#37117;&#20195;&#29702;<code class="literal">ChannelEntryPoint</code>&#12290;
        &#21253;&#21547;&#22312;Spring Security&#37324;&#30340;&#36825;&#20004;&#20010;<code class="literal">ChannelEntryPoint</code>&#23454;&#29616;&#65292;&#21482;&#26159;&#25226;&#35831;&#27714;&#31616;&#21333;&#37325;&#23450;&#21521;&#21040;&#21512;&#36866;&#30340;HTTP&#25110;HTTPS&#12290;
        &#21512;&#36866;&#30340;&#40664;&#35748;&#20998;&#37197;&#32473;<code class="literal">ChannelProcessor</code>&#23454;&#29616;&#65292;&#20026;&#23427;&#20204;&#30456;&#24212;&#30340;&#37197;&#32622;&#23646;&#24615;&#20851;&#38190;&#23383;&#21644;&#23427;&#20204;&#20195;&#34920;&#30340;<code class="interfacename">ChannelProcessor</code>&#65292;&#19981;&#36807;&#65292;&#20320;&#21487;&#20197;&#20351;&#29992;application context&#37325;&#20889;&#23427;&#20204;&#12290;</p>

    <p>&#27880;&#24847;&#65292;&#37325;&#23450;&#21521;&#20351;&#29992;&#30340;&#26159;&#32477;&#23545;&#22320;&#22336;&#65288;&#27604;&#22914;<code class="literal">http://www.company.com:8080/app/page</code>&#65289;&#65292;&#19981;&#26159;&#30456;&#23545;&#22320;&#22336;&#65288;&#27604;&#22914;<code class="literal">/app/page</code>&#65289;&#12290;
        &#22312;&#27979;&#35797;&#36807;&#31243;&#20013;&#65292;&#21457;&#29616;&#20102;IE6 sp1&#30340;&#19968;&#20010;bug&#65292;&#22312;&#37325;&#23450;&#21521;&#26102;&#65292;&#22914;&#26524;&#21482;&#25913;&#21464;&#20102;&#31471;&#21475;&#65292;&#23427;&#23601;&#19981;&#33021;&#21709;&#24212;&#25104;&#21151;&#12290;
        &#22240;&#27492;&#65292;&#32477;&#23545;URL&#23601;&#26159;&#29992;&#26469;&#22312;<code class="classname">PortResolverImpl</code>&#20013;&#65292;&#35299;&#20915;&#36825;&#20010;bug&#26816;&#27979;&#36923;&#36753;&#65292;&#36825;&#26159;&#40664;&#35748;&#24773;&#20917;&#19979;&#34987;Spring Security bean&#20351;&#29992;&#30340;&#12290;
        &#35831;&#21442;&#32771;<code class="classname">PortResolverImpl</code>&#30340;JavaDocs&#33719;&#24471;&#26356;&#22810;&#20449;&#24687;&#12290;</p>

    <p>&#20320;&#24212;&#35813;&#27880;&#24847;&#65292;&#22312;&#30331;&#24405;&#36807;&#31243;&#20013;&#65292;&#25512;&#33616;&#20351;&#29992;&#20449;&#36947;&#23433;&#20840;&#65292;&#20445;&#25345;&#29992;&#25143;&#21517;&#21644;&#23494;&#30721;&#30340;&#23433;&#20840;&#12290;
        &#22914;&#26524;&#20320;&#27809;&#26377;&#20915;&#23450;&#22312;&#22522;&#20110;&#34920;&#21333;&#30340;&#30331;&#24405;&#37324;&#20351;&#29992;<code class="classname">ChannelProcessingFilter</code>&#12290;
        &#35831;&#30830;&#35748;&#20320;&#30340;&#30331;&#24405;&#39029;&#65292;&#35774;&#32622;&#20102;<code class="literal">REQUIRES_SECURE_CHANNEL</code>&#65292;&#24182;&#35753;<code class="literal">AuthenticationProcessingFilterEntryPoint.forceHttps</code>&#30340;&#20540;&#26159;<code class="literal">true</code>&#12290;</p>
</div>

<div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="channel-security-conclusion"></a>7.3.&nbsp;&#24635;&#32467;</h2></div></div></div>
    

    <p>&#19968;&#26086;&#37197;&#32622;&#22909;&#65292;&#20351;&#29992;&#20449;&#36947;&#23433;&#20840;&#36807;&#28388;&#22120;&#23601;&#38750;&#24120;&#31616;&#21333;&#20102;&#12290;
        &#31616;&#21333;&#35831;&#27714;&#39029;&#38754;&#65292;&#19981;&#38480;&#21046;&#21327;&#35758;&#65288;&#27604;&#22914;HTTP&#25110;HTTPS&#65289;&#25110;&#31471;&#21475;&#65288;&#27604;&#22914;80,8080,443,8443&#31561;&#31561;&#65289;&#12290;
        &#24456;&#26126;&#26174;&#65292;&#25105;&#20204;&#36824;&#38656;&#35201;&#37197;&#32622;&#21021;&#22987;&#35831;&#27714;&#65288;&#21487;&#33021;&#36890;&#36807;<code class="literal">web.xml</code>&#30340;<code class="literal">&lt;welcome-file&gt;</code>&#25110;&#19968;&#20010;&#20247;&#25152;&#21608;&#30693;&#30340;&#20027;&#39029;URL&#65289;&#65292;&#20294;&#26159;&#19968;&#26086;&#36825;&#20010;&#21457;&#29983;&#20102;&#65292;&#36807;&#28388;&#22120;&#23601;&#20250;&#25353;&#29031;&#20320;&#30340;application context&#23450;&#20041;&#30340;&#37027;&#26679;&#25191;&#34892;&#37325;&#23450;&#21521;&#12290;</p>

    <p>&#20320;&#20063;&#21487;&#20197;&#28155;&#21152;&#33258;&#24049;&#30340;<code class="literal">ChannelProcessor</code>&#23454;&#29616;<code class="literal">ChannelDecisionManagerImpl</code>&#12290;
        &#27604;&#22914;&#65292;&#20320;&#21487;&#33021;&#22312;&#20351;&#29992;&#8220;&#36755;&#20837;&#22270;&#29255;&#20013;&#30340;&#20869;&#23481;&#8221;&#26816;&#27979;&#30495;&#20154;&#29992;&#25143;&#30340;&#36807;&#31243;&#20013;&#65292;&#35201;&#35774;&#32622;&#19968;&#20010;<code class="literal">HttpSession</code>&#23646;&#24615;&#12290;
        &#20320;&#30340;<code class="literal">ChannelProcessor</code>&#20250;&#21709;&#24212;<code class="literal">REQUIRES_HUMAN_USER</code>&#37197;&#32622;&#23646;&#24615;&#65292;&#28982;&#21518;&#37325;&#23450;&#21521;&#21040;&#21512;&#36866;&#30340;&#20837;&#21475;&#28857;&#65292;&#22914;&#26524;<code class="literal">HttpSession</code>&#23646;&#24615;&#36824;&#27809;&#26377;&#35774;&#32622;&#65292;&#21551;&#21160;&#30495;&#20154;&#29992;&#25143;&#30340;&#39564;&#35777;&#36807;&#31243;&#12290;</p>

    <p>&#20026;&#20102;&#20915;&#23450;&#26159;&#21542;&#36827;&#34892;&#19968;&#20010;&#23433;&#20840;&#26816;&#27979;&#65292;&#20381;&#38752;<code class="literal">ChannelProcessor</code>&#25110;<code class="literal">AccessDecisionVoter</code>&#65292;&#21069;&#19968;&#20010;&#34987;&#35774;&#35745;&#25104;&#22788;&#29702;&#26410;&#35748;&#35777;&#30340;&#35831;&#27714;&#65292;&#32780;&#21518;&#19968;&#20010;&#34987;&#35774;&#35745;&#25104;&#22788;&#29702;&#24050;&#35748;&#35777;&#30340;&#35831;&#27714;&#12290;
    &#22240;&#27492;&#65292;&#21518;&#19968;&#20010;&#21487;&#20197;&#35775;&#38382;&#39564;&#35777;&#20027;&#20307;&#30340;&#34987;&#25480;&#26435;&#26435;&#38480;&#12290;
        &#21478;&#22806;&#65292;<code class="literal">ChannelProcessor</code>&#26816;&#27979;&#21040;&#38382;&#39064;&#65292;&#23601;&#20250;&#36827;&#34892;HTTP/HTTPS&#30340;&#37325;&#23450;&#21521;&#65292;&#26469;&#28385;&#36275;&#23427;&#30340;&#38656;&#27714;&#12290;
        <code class="literal">AccessDecisionVoter</code>&#26816;&#27979;&#21040;&#19968;&#20010;&#38382;&#39064;&#65292;&#20250;&#23548;&#33268;&#19968;&#20010;<code class="literal">AccessDeniedException</code>&#65288;&#21462;&#20915;&#20110;<code class="literal">AccessDecisionManager</code>&#65289;&#12290;</p>
</div>
</div><div xmlns:fo="http://www.w3.org/1999/XSL/Format" class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="supporting-infrastructure.html" tppabs="http://www.family168.com/tutorial/springsecurity/html/supporting-infrastructure.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="springsecurity.html" tppabs="http://www.family168.com/tutorial/springsecurity/html/springsecurity.html">Home</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="authentication.html" tppabs="http://www.family168.com/tutorial/springsecurity/html/authentication.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;6.&nbsp;&#25903;&#25345;&#30340;&#22522;&#30784;&#35774;&#26045;&nbsp;</td><td width="20%" align="center"><span style="color:white;font-size:90%;"><a href="javascript:if(confirm('http://www.springsource.com/  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://www.springsource.com/'" tppabs="http://www.springsource.com/" title="SpringSource">Sponsored by SpringSource
                                        </a></span></td><td width="40%" align="right" valign="top">&nbsp;Part&nbsp;III.&nbsp;&#35748;&#35777;</td></tr></table></div></body></html><script type="text/javascript">var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www./");document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));</script><script type="text/javascript">var pageTracker = _gat._getTracker("UA-2857097-3");pageTracker._initData();pageTracker._trackPageview();</script>