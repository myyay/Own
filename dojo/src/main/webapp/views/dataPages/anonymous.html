<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;17.&nbsp;&#21311;&#21517;&#35748;&#35777;</title><link rel="stylesheet" href="html.css" tppabs="http://www.family168.com/tutorial/springsecurity/html/css/html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.72.0"><link rel="start" href="springsecurity.html" title="Spring Security"><link rel="up" href="authentication.html" title="Part&nbsp;III.&nbsp;&#35748;&#35777;"><link rel="prev" href="preauth.html" title="Chapter&nbsp;16.&nbsp;&#39044;&#35748;&#35777;&#22330;&#26223;"><link rel="next" href="x509.html" title="Chapter&nbsp;18.&nbsp;X.509&#35748;&#35777;"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div xmlns:fo="http://www.w3.org/1999/XSL/Format" style="background-color:white;border:none;height:73px;border:1px solid black;"><a style="border:none;" href="javascript:if(confirm('http://static.springframework.org/spring-ws/site/  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://static.springframework.org/spring-ws/site/'" tppabs="http://static.springframework.org/spring-ws/site/" title="The Spring Framework - Spring Web Services"><img style="border:none;" src="xdev-spring_logo.jpg" tppabs="http://www.family168.com/tutorial/springsecurity/html/images/xdev-spring_logo.jpg"></a><a style="border:none;" href="javascript:if(confirm('http://www.springsource.com/  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://www.springsource.com/'" tppabs="http://www.springsource.com/" title="SpringSource"><img style="border:none;position:absolute;padding-top:5px;right:42px;" src="s2-banner-rhs.png" tppabs="http://www.family168.com/tutorial/springsecurity/html/images/s2-banner-rhs.png"></a></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h1 class="title"><a name="anonymous"></a>&#21311;&#21517;&#35748;&#35777;</h1></div></div></div>


<div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="anonymous-overview"></a>17.1.&nbsp;&#27010;&#36848;</h2></div></div></div>


    <p>&#26377;&#26102;&#65292;&#29305;&#21035;&#26159;&#22312;web&#35831;&#27714;URI&#23433;&#20840;&#30340;&#24773;&#20917;&#37324;&#65292;&#20026;&#27599;&#20010;&#23433;&#20840;&#23545;&#35937;&#30340;&#35843;&#29992;&#37117;&#20998;&#37197;&#19968;&#20010;&#37197;&#32622;&#23646;&#24615;&#26356;&#26041;&#20415;&#12290;
        &#19981;&#21516;&#30340;&#26159;&#65292;&#26377;&#26102;&#40664;&#35748;&#38656;&#35201;&#19968;&#20010;<code class="literal">ROLE_SOMETHING</code>&#26356;&#22909;&#19968;&#20123;&#65292;&#36825;&#20010;&#35268;&#21017;&#21482;&#20801;&#35768;&#19968;&#20123;&#29305;&#23450;&#20363;&#22806;&#65292;&#27604;&#22914;&#30331;&#24405;&#65292;&#27880;&#38144;&#65292;&#31995;&#32479;&#30340;&#39318;&#39029;&#12290;
        &#20063;&#26377;&#38656;&#35201;&#21311;&#21517;&#35748;&#35777;&#30340;&#20854;&#20182;&#24773;&#20917;&#65292;&#27604;&#22914;&#23457;&#26680;&#25318;&#25130;&#22120;&#26597;&#35810;<code class="literal">SecurityContextHolder</code>&#26469;&#30830;&#23450;&#21738;&#20010;&#20027;&#20307;&#21487;&#20197;&#20351;&#29992;&#23545;&#24212;&#30340;&#25805;&#20316;&#12290;
        &#22914;&#26524;&#23427;&#20204;&#33021;&#30830;&#23450;<code class="literal">SecurityContextHolder</code>&#37324;&#24635;&#26159;&#21253;&#21547;&#19968;&#20010;<code class="literal">Authentication</code>&#23545;&#35937;&#65292;&#32780;&#19981;&#21487;&#33021;&#26159;<code class="literal">null</code>&#65292;&#36825;&#20123;&#31867;&#23601;&#21487;&#20197;&#24471;&#21040;&#26356;&#22810;&#30340;&#40065;&#26834;&#24615;&#12290;</p>
</div>

<div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="anonymous-config"></a>17.2.&nbsp;&#37197;&#32622;</h2></div></div></div>


    <p>Spring Security&#25552;&#20379;&#19977;&#20010;&#31867;&#26469;&#19968;&#36215;&#25552;&#20379;&#21311;&#21517;&#35748;&#35777;&#21151;&#33021;&#12290;
        <code class="literal">AnonymousAuthenticationToken</code>&#23454;&#29616;&#20102;<code class="literal">Authentication</code>&#65292;&#20445;&#23384;&#30528;<code class="literal">GrantedAuthority[]</code>&#65292;&#29992;&#26469;&#22788;&#29702;&#21311;&#21517;&#20027;&#20307;&#12290;
        &#26377;&#19968;&#20010;&#23545;&#24212;&#30340;&#38656;&#35201;&#38142;&#20837;<code class="literal">ProviderManager</code>&#30340;<code class="literal">AnonymousAuthenticationProvider</code>&#65292;&#21487;&#20197;&#20174;&#20013;&#33719;&#24471;<code class="literal">AnonymousAuthenticationTokens</code>&#12290;
        &#26368;&#21518;&#26159;AnonymousProcessingFilter&#65292;&#38656;&#35201;&#20018;&#38142;&#21040;&#26222;&#36890;&#35748;&#35777;&#26426;&#21046;&#21518;&#38754;&#65292;&#22914;&#26524;&#36824;&#27809;&#26377;&#23384;&#22312;&#30340;<code class="literal">Authentication</code>&#30340;&#35805;&#65292;&#23427;&#20250;&#33258;&#21160;&#21521;<code class="literal">SecurityContextHolder</code>&#28155;&#21152;&#19968;&#20010;<code class="literal">AnonymousAuthenticationToken</code>&#12290;
        &#36807;&#28388;&#22120;&#21644;&#35748;&#35777;&#25552;&#20379;&#22120;&#30340;&#37197;&#32622;&#22914;&#19979;&#65306;</p>

    <pre class="programlisting">

&lt;bean id="anonymousProcessingFilter"
    class="org.springframework.security.providers.anonymous.AnonymousProcessingFilter"&gt;
  &lt;property name="key" value="foobar"/&gt;
  &lt;property name="userAttribute" value="anonymousUser,ROLE_ANONYMOUS"/&gt;
&lt;/bean&gt;

&lt;bean id="anonymousAuthenticationProvider"
    class="org.springframework.security.providers.anonymous.AnonymousAuthenticationProvider"&gt;
  &lt;property name="key" value="foobar"/&gt;
&lt;/bean&gt;
    </pre>

    <p>&#36825;&#20010; <code class="literal">key</code> &#20250;&#22312;&#36807;&#28388;&#22120;&#21644;&#35748;&#35777;&#25552;&#20379;&#22120;&#20043;&#38388;&#20849;&#20139;&#65292;&#36825;&#26679;&#21019;&#24314;&#30340;&#26631;&#35760;&#21487;&#20197;&#22312;&#20197;&#21518;&#29992;&#21040;&#12290;
        <code class="literal">userAttribute</code>&#34920;&#36798;&#24335;&#30340;&#26684;&#24335;&#26159;<code class="literal">usernameInTheAuthenticationToken,grantedAuthority[,grantedAuthority]</code>&#12290;
        &#36825;&#21644;<code class="literal">InMemoryDaoImpl</code>&#20013;<code class="literal">userMap</code>&#23646;&#24615;&#30340;&#35821;&#27861;&#19968;&#26679;&#12290;</p>

    <p>&#22914;&#19978;&#38754;&#25152;&#35762;&#30340;&#65292;&#21311;&#21517;&#35748;&#35777;&#30340;&#22909;&#22788;&#26159;&#65292;&#21487;&#20197;&#23545;&#25152;&#26377;&#30340;URL&#27169;&#24335;&#37117;&#36827;&#34892;&#23433;&#20840;&#37197;&#32622;&#12290;
        &#27604;&#22914;&#65306;</p>

    <pre class="programlisting">

&lt;bean id="filterInvocationInterceptor"
    class="org.springframework.security.intercept.web.FilterSecurityInterceptor"&gt;
  &lt;property name="authenticationManager" ref="authenticationManager"/&gt;
  &lt;property name="accessDecisionManager" ref="httpRequestAccessDecisionManager"/&gt;
  &lt;property name="objectDefinitionSource"&gt;
    &lt;security:filter-invocation-definition-source&gt;
      &lt;security:intercept-url pattern='/index.jsp' access='ROLE_ANONYMOUS,ROLE_USER'/&gt;
      &lt;security:intercept-url pattern='/hello.htm' access='ROLE_ANONYMOUS,ROLE_USER'/&gt;
      &lt;security:intercept-url pattern='/logoff.jsp' access='ROLE_ANONYMOUS,ROLE_USER'/&gt;
      &lt;security:intercept-url pattern='/login.jsp' access='ROLE_ANONYMOUS,ROLE_USER'/&gt;
      &lt;security:intercept-url pattern='/**' access='ROLE_USER'/&gt;
    &lt;/security:filter-invocation-definition-source&gt;
  &lt;/property&gt;
&lt;/bean&gt;
    </pre><p>&#31616;&#30053;&#23545;&#21311;&#21517;&#35748;&#35777;&#30340;&#35752;&#35770;&#65292;&#23601;&#26159;<code class="literal">AuthenticationTrustResolver</code>&#25509;&#21475;&#65292;&#23427;&#23545;&#24212;&#30528;<code class="literal">AuthenticationTrustResolverImpl</code>&#23454;&#29616;&#12290;
        &#36825;&#20010;&#25509;&#21475;&#25552;&#20379;&#20102;&#19968;&#20010;<code class="literal">isAnonymous(Authentication)</code>&#26041;&#27861;&#65292;&#20801;&#35768;&#24863;&#20852;&#36259;&#30340;&#31867;&#35780;&#20272;&#35748;&#35777;&#30340;&#29305;&#27530;&#29366;&#24577;&#31867;&#22411;&#12290;
        &#22312;&#22788;&#29702;<code class="literal">AccessDeniedException</code>&#24322;&#24120;&#30340;&#26102;&#20505;&#65292;<code class="literal">ExceptionTranslationFilter</code>&#20351;&#29992;&#36825;&#20010;&#25509;&#21475;&#12290;
        &#22914;&#26524;&#25243;&#20986;&#20102;&#19968;&#20010;<code class="literal">AccessDeniedException</code>&#24322;&#24120;&#65292;&#32780;&#19988;&#35748;&#35777;&#26159;&#21311;&#21517;&#31867;&#22411;&#65292;&#37027;&#20040;&#19981;&#20250;&#25243;&#20986;403&#65288;&#31105;&#27490;&#65289;&#21709;&#24212;&#65292;&#36825;&#20010;&#36807;&#28388;&#22120;&#20250;&#23637;&#24320;<code class="literal">AuthenticationEntryPoint</code>&#65292;&#36825;&#26679;&#20027;&#20307;&#21487;&#20197;&#27491;&#30830;&#39564;&#35777;&#12290;
        &#36825;&#26159;&#19968;&#20010;&#24517;&#35201;&#30340;&#21306;&#21035;&#65292;&#21542;&#21017;&#20027;&#20307;&#20250;&#19968;&#30452;&#34987;&#35748;&#20026;&#8220;&#38656;&#35201;&#35748;&#35777;&#8221;&#65292;&#27809;&#26377;&#26426;&#20250;&#36890;&#36807;&#34920;&#21333;&#65292;&#25688;&#35201;&#65292;&#25110;&#20854;&#20182;&#26222;&#36890;&#30340;&#35748;&#35777;&#26426;&#21046;&#30331;&#24405;&#12290;</p>
</div>
</div><div xmlns:fo="http://www.w3.org/1999/XSL/Format" class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="preauth.html" tppabs="http://www.family168.com/tutorial/springsecurity/html/preauth.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="springsecurity.html" tppabs="http://www.family168.com/tutorial/springsecurity/html/springsecurity.html">Home</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="x509.html" tppabs="http://www.family168.com/tutorial/springsecurity/html/x509.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;16.&nbsp;&#39044;&#35748;&#35777;&#22330;&#26223;&nbsp;</td><td width="20%" align="center"><span style="color:white;font-size:90%;"><a href="javascript:if(confirm('http://www.springsource.com/  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://www.springsource.com/'" tppabs="http://www.springsource.com/" title="SpringSource">Sponsored by SpringSource
                                        </a></span></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;18.&nbsp;X.509&#35748;&#35777;</td></tr></table></div></body></html><script type="text/javascript">var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www./");document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));</script><script type="text/javascript">var pageTracker = _gat._getTracker("UA-2857097-3");pageTracker._initData();pageTracker._trackPageview();</script>