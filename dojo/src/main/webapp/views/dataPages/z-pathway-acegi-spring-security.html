<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;25.&nbsp;acegi&#21040;spring security&#30340;&#36716;&#25442;&#26041;&#24335;</title><link rel="stylesheet" href="html.css" tppabs="http://www.family168.com/tutorial/springsecurity/html/css/html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.72.0"><link rel="start" href="springsecurity.html" title="Spring Security"><link rel="up" href="authorization.html" title="Part&nbsp;IV.&nbsp;&#25480;&#26435;"><link rel="prev" href="domain-acls.html" title="Chapter&nbsp;24.&nbsp;&#39046;&#22495;&#23545;&#35937;&#23433;&#20840;"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div xmlns:fo="http://www.w3.org/1999/XSL/Format" style="background-color:white;border:none;height:73px;border:1px solid black;"><a style="border:none;" href="javascript:if(confirm('http://static.springframework.org/spring-ws/site/  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://static.springframework.org/spring-ws/site/'" tppabs="http://static.springframework.org/spring-ws/site/" title="The Spring Framework - Spring Web Services"><img style="border:none;" src="xdev-spring_logo.jpg" tppabs="http://www.family168.com/tutorial/springsecurity/html/images/xdev-spring_logo.jpg"></a><a style="border:none;" href="javascript:if(confirm('http://www.springsource.com/  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://www.springsource.com/'" tppabs="http://www.springsource.com/" title="SpringSource"><img style="border:none;position:absolute;padding-top:5px;right:42px;" src="s2-banner-rhs.png" tppabs="http://www.family168.com/tutorial/springsecurity/html/images/s2-banner-rhs.png"></a></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h1 class="title"><a name="z-pathway-acegi-spring-security"></a>acegi&#21040;spring security&#30340;&#36716;&#25442;&#26041;&#24335;</h1></div></div></div>
    

    <p>
      &#20316;&#32773; Chris.Baker&#65292;&#21457;&#34920;&#20110; 2008/04/22 - 9:44am.
    </p>

    <p>
      <a xmlns:xlink="http://www.w3.org/1999/xlink" href="javascript:if(confirm('http://java.dzone.com/tips/pathway-acegi-spring-security-  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://java.dzone.com/tips/pathway-acegi-spring-security-'" tppabs="http://java.dzone.com/tips/pathway-acegi-spring-security-" target="_top">http://java.dzone.com/tips/pathway-acegi-spring-security-</a>
    </p>

    <p>
      &#20197;&#21069;&#23427;&#21483;&#20570;spring&#30340;acegi&#23433;&#20840;&#26694;&#26550;&#65292;&#29616;&#22312;&#37325;&#26032;&#26631;&#35782;&#20026;spring security 2.0&#65292;&#23427;&#23454;&#29616;&#20102;&#31616;&#26131;&#37197;&#32622;&#30340;&#25215;&#35834;&#65292;&#25552;&#39640;&#20102;&#24320;&#21457;&#32773;&#30340;&#29983;&#20135;&#21147;&#12290;
      &#23427;&#24050;&#32463;&#26159;java&#24179;&#21488;&#19978;&#24212;&#29992;&#26368;&#24191;&#30340;&#23433;&#20840;&#26694;&#26550;&#20102;&#65292;&#22312;sourceforge&#19978;&#25317;&#26377;250,000&#30340;&#19979;&#36733;&#37327;&#65292;Spring Security 2.0&#21448;&#25552;&#20379;&#20102;&#19968;&#31995;&#21015;&#30340;&#26032;&#21151;&#33021;&#12290;
    </p>

    <p>
      &#26412;&#25991;&#20027;&#35201;&#20171;&#32461;&#20102;&#22914;&#26524;&#25226;&#20043;&#21069;&#24314;&#31435;&#22312;acegi&#22522;&#30784;&#19978;&#30340;spring&#24212;&#29992;&#36716;&#25442;&#21040;spring security 2.0&#19978;&#12290;
    </p>

    <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="z-p-what-is-spring-security-2-0"></a>25.1.&nbsp;Spring Security&#26159;&#20160;&#20040;</h2></div></div></div>
        

        <p>
          Spring Security&#26159;&#30446;&#21069;&#29992;&#20110;&#26367;&#25442;acegi&#30340;&#26694;&#26550;&#65292;&#23427;&#25552;&#20379;&#20102;&#19968;&#31995;&#21015;&#26032;&#30340;&#21151;&#33021;&#12290;
        </p>

        <div class="itemizedlist"><ul type="disc"><li>
                <p>&#22823;&#20026;&#31616;&#21270;&#20102;&#37197;&#32622;</p>
            </li><li>
                <p>&#32487;&#25215;OpenID&#65292;&#26631;&#20934;&#21333;&#28857;&#30331;&#24405;</p>
            </li><li>
                <p>&#25903;&#25345;windows NTLM&#65292;&#22312;windows&#21512;&#20316;&#32593;&#32476;&#19978;&#23454;&#29616;&#21333;&#28857;&#30331;&#24405;</p>
            </li><li>
                <p>&#25903;&#25345;JSR 250("EJB 3")&#30340;&#23433;&#20840;&#27880;&#35299;</p>
            </li><li>
                <p>&#25903;&#25345;AspectJ&#20999;&#28857;&#34920;&#36798;&#24335;&#35821;&#35328;</p>
            </li><li>
                <p>&#20840;&#38754;&#25903;&#25345;REST Web&#35831;&#27714;&#25480;&#26435;</p>
            </li><li>
                <p>&#38271;&#26399;&#35201;&#27714;&#30340;&#25903;&#25345;&#32452;&#65292;&#23618;&#32423;&#35282;&#33394;&#21644;&#29992;&#25143;&#31649;&#29702;API</p>
            </li><li>
                <p>&#25552;&#21319;&#20102;&#21151;&#33021;&#65292;&#20351;&#29992;&#21518;&#21488;&#25968;&#25454;&#24211;&#30340;remember-me&#23454;&#29616;</p>
            </li><li>
                <p>&#36890;&#36807;spring webflow 2.0&#23545;web&#29366;&#24577;&#21644;&#27969;&#36716;&#25480;&#26435;&#36827;&#34892;&#26032;&#30340;&#25903;&#25345;</p>
            </li><li>
                <p>&#36890;&#36807;Spring Web Services 1.5&#21152;&#24378;&#23545;WSS&#65288;&#21407;&#26469;&#30340;WS-Security&#65289;&#30340;&#25903;&#25345;</p>
            </li><li>
                <p>&#25972;&#20010;&#26356;&#22810;&#30340;&#8230;&#8230;</p>
            </li></ul></div>
    </div>

    <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="z-p-goal"></a>25.2.&nbsp;&#30446;&#26631;</h2></div></div></div>
        

        <p>
          &#30446;&#21069;&#65292;&#25105;&#24037;&#20316;&#22312;&#19968;&#20010;spring&#30340;web&#24212;&#29992;&#19978;&#65292;&#20351;&#29992;acegi&#25511;&#21046;&#23545;&#36164;&#28304;&#30340;&#35775;&#38382;&#26435;&#38480;&#12290;
          &#29992;&#25143;&#20449;&#24687;&#20445;&#23384;&#22312;&#25968;&#25454;&#24211;&#20013;&#65292;&#25105;&#20204;&#37197;&#32622;acegi&#20351;&#29992;&#20102;&#22522;&#20110;JDBC&#30340;UserDetails&#26381;&#21153;&#12290;
          &#21516;&#26679;&#30340;&#65292;&#25105;&#20204;&#25152;&#26377;&#30340;web&#36164;&#28304;&#37117;&#20445;&#23384;&#22312;&#25968;&#25454;&#24211;&#37324;&#65292;acegi&#37197;&#32622;&#25104;&#20351;&#29992;&#33258;&#23450;&#20041;&#30340;AbstractFilterInvocationDefinitionSource&#65292;&#23545;&#27599;&#20010;&#35831;&#27714;&#26816;&#27979;&#25480;&#26435;&#32454;&#33410;&#12290;
        </p>

        <p>
          &#38543;&#30528;Spring Security 2.0&#30340;&#21457;&#24067;&#65292;&#25105;&#24819;&#30475;&#30475;&#26159;&#19981;&#26159;&#21487;&#20197;&#26367;&#25442;acegi&#65292;&#20294;&#36824;&#35201;&#20445;&#25345;&#24403;&#21069;&#30340;&#21151;&#33021;&#65292;&#20351;&#29992;&#25968;&#25454;&#24211;&#20316;&#20026;&#25105;&#20204;&#39564;&#35777;&#21644;&#25480;&#26435;&#30340;&#25968;&#25454;&#28304;&#65292;&#32780;&#19981;&#26159;xml&#37197;&#32622;&#25991;&#20214;&#65288;&#22823;&#22810;&#25968;&#28436;&#31034;&#31243;&#24207;&#37324;&#20351;&#29992;&#30340;&#37117;&#26159;xml&#65289;&#12290;
        </p>

        <p>
          &#36825;&#37324;&#26159;&#25105;&#37319;&#21462;&#30340;&#27493;&#39588;&#8230;&#8230;
        </p>
    </div>

    <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="z-p-step"></a>25.3.&nbsp;&#27493;&#39588;</h2></div></div></div>
        

        <div class="orderedlist"><ol type="1"><li>
                <p>&#31532;&#19968;&#27493;&#65288;&#20063;&#26159;&#26368;&#37325;&#35201;&#30340;&#65289;&#26159;&#19979;&#36733;&#26032;&#30340;Spring Security 2.0&#26694;&#26550;&#65292;&#24182;&#30830;&#20445;jar&#25991;&#20214;&#25918;&#21040;&#27491;&#30830;&#30340;&#20301;&#32622;&#65288;/WEB-INF/lib/&#65289;&#12290;</p>
                <p>Spring Security 2.0&#19979;&#36733;&#21253;&#37324;&#21253;&#21547;22&#20010;jar&#25991;&#20214;&#12290;&#25105;&#19981;&#38656;&#35201;&#25226;&#23427;&#20204;&#20840;&#29992;&#19978;&#65288;&#23588;&#20854;&#26159;&#37027;&#20123;sources&#21253;&#65289;&#12290;&#22312;&#36825;&#27425;&#32451;&#20064;&#20013;&#25105;&#20165;&#20165;&#21253;&#21547;&#20102;&#20197;&#19979;&#20960;&#20010;&#65306;</p>
                <div class="itemizedlist"><ul type="disc"><li>
                        <p>spring-security-acl-2.0.0.jar</p>
                    </li><li>
                        <p>spring-security-core-2.0.0.jar</p>
                    </li><li>
                        <p>spring-security-core-tiger-2.0.0.jar</p>
                    </li><li>
                        <p>spring-security-taglibs-2.0.0.jar</p>
                    </li></ul></div>
            </li><li>
                <p>&#22312;web.xml&#25991;&#20214;&#37324;&#37197;&#32622;&#19968;&#20010;DelegatingFilterProxy</p>
                <pre class="programlisting">
&lt;filter&gt;
    &lt;filter-name&gt;springSecurityFilterChain&lt;/filter-name&gt;
    &lt;filter-class&gt;org.springframework.web.filter.DelegatingFilterProxy&lt;/filter-class&gt;
&lt;/filter&gt;
&lt;filter-mapping&gt;
    &lt;filter-name&gt;springSecurityFilterChain&lt;/filter-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;
                </pre>
            </li><li>
                <p>Spring Security 2.0&#30340;&#37197;&#32622;&#27604;acegi&#31616;&#21333;&#22826;&#22810;&#20102;&#65292;&#25152;&#20197;&#25105;&#27809;&#26377;&#22312;&#20197;&#21069;acegi&#37197;&#32622;&#25991;&#20214;&#30340;&#22522;&#30784;&#19978;&#36827;&#34892;&#20462;&#25913;&#65292;&#25105;&#21457;&#29616;&#20174;&#19968;&#20010;&#31354;&#30333;&#25991;&#20214;&#24320;&#22987;&#26356;&#31616;&#21333;&#12290;&#22914;&#26524;&#20320;&#24819;&#20462;&#25913;&#20320;&#20197;&#21069;&#30340;&#37197;&#32622;&#25991;&#20214;&#65292;&#25105;&#30830;&#23450;&#20320;&#21024;&#38500;&#30340;&#34892;&#25968;&#27604;&#28155;&#21152;&#30340;&#34892;&#25968;&#36824;&#35201;&#22810;&#12290;</p>
                <p>&#37197;&#32622;&#25991;&#20214;&#30340;&#31532;&#19968;&#37096;&#20998;&#26159;&#25351;&#23450;&#23433;&#20840;&#36164;&#28304;&#36807;&#28388;&#22120;&#30340;&#32454;&#33410;&#65292;&#36825;&#35753;&#23433;&#20840;&#36164;&#28304;&#21487;&#20197;&#36890;&#36807;&#25968;&#25454;&#24211;&#35835;&#21462;&#65292;&#32780;&#19981;&#26159;&#22312;&#37197;&#32622;&#25991;&#20214;&#37324;&#20445;&#23384;&#20449;&#24687;&#12290;&#36825;&#37324;&#26159;&#19968;&#20010;&#20320;&#23558;&#22312;&#22823;&#22810;&#25968;&#20363;&#23376;&#20013;&#30475;&#21040;&#30340;&#20195;&#30721;&#12290;</p>
                <pre class="programlisting">
&lt;http auto-config="true" access-denied-page="/403.jsp"&gt;
    &lt;intercept-url pattern="/index.jsp" access="ROLE_ADMINISTRATOR,ROLE_USER"/&gt;
    &lt;intercept-url pattern="/securePage.jsp" access="ROLE_ADMINISTRATOR"/&gt;
    &lt;intercept-url pattern="/**" access="ROLE_ANONYMOUS" /&gt;
&lt;/http&gt;
                </pre>
                <p>&#20351;&#29992;&#36825;&#20123;&#20869;&#23481;&#36827;&#34892;&#26367;&#25442;&#65306;</p>
                <pre class="programlisting">
&lt;authentication-manager alias="authenticationManager"/&gt;

&lt;beans:bean id="accessDecisionManager" class="org.springframework.security.vote.AffirmativeBased"&gt;
    &lt;beans:property name="allowIfAllAbstainDecisions" value="false"/&gt;
    &lt;beans:property name="decisionVoters"&gt;
        &lt;beans:list&gt;
            &lt;beans:bean class="org.springframework.security.vote.RoleVoter"/&gt;
            &lt;beans:bean class="org.springframework.security.vote.AuthenticatedVoter"/&gt;
        &lt;/beans:list&gt;
    &lt;/beans:property&gt;
&lt;/beans:bean&gt;

&lt;beans:bean id="filterInvocationInterceptor" class="org.springframework.security.intercept.web.FilterSecurityInterceptor"&gt;
&lt;beans:property name="authenticationManager" ref="authenticationManager"/&gt;
    &lt;beans:property name="accessDecisionManager" ref="accessDecisionManager"/&gt;
    &lt;beans:property name="objectDefinitionSource" ref="secureResourceFilter" /&gt;
&lt;/beans:bean&gt;

&lt;beans:bean id="secureResourceFilter" class="org.security.SecureFilter.MySecureResourceFilter" /&gt;

&lt;http auto-config="true" access-denied-page="/403.jsp"&gt;
    &lt;concurrent-session-control max-sessions="1" exception-if-maximum-exceeded="true" /&gt;
    &lt;form-login login-page="/login.jsp" authentication-failure-url="/login.jsp" default-target-url="/index.jsp" /&gt;
    &lt;logout logout-success-url="/login.jsp"/&gt;
&lt;/http&gt;
                </pre>
                <p>&#36825;&#27573;&#37197;&#32622;&#30340;&#20027;&#35201;&#37096;&#20998;secureResourceFilter&#65292;&#36825;&#26159;&#19968;&#20010;&#23454;&#29616;&#20102;FilterInvocationDefinitionSource&#30340;&#31867;&#65292;&#23427;&#22312;Spring Security&#38656;&#35201;&#23545;&#35831;&#27714;&#39029;&#38754;&#26816;&#27979;&#26435;&#38480;&#30340;&#26102;&#20505;&#35843;&#29992;&#12290;&#36825;&#37324;&#26159;MySecureResouceFilter&#30340;&#20195;&#30721;&#65306;</p>
                <pre class="programlisting">
package org.security.SecureFilter;

import java.util.Collection;
import java.util.List;

import org.springframework.security.ConfigAttributeDefinition;
import org.springframework.security.ConfigAttributeEditor;
import org.springframework.security.intercept.web.FilterInvocation;
import org.springframework.security.intercept.web.FilterInvocationDefinitionSource;


public class MySecureResourceFilter implements FilterInvocationDefinitionSource {

    public ConfigAttributeDefinition getAttributes(Object filter) throws IllegalArgumentException {

        FilterInvocation filterInvocation = (FilterInvocation) filter;

        String url = filterInvocation.getRequestUrl();

        // create a resource object that represents this Url object
        Resource resource = new Resource(url);

        if (resource == null) return null;
        else{
            ConfigAttributeEditor configAttrEditor = new ConfigAttributeEditor();
            // get the Roles that can access this Url
            List&lt;Role&gt; roles = resource.getRoles();
            StringBuffer rolesList = new StringBuffer();
            for (Role role : roles){
                rolesList.append(role.getName());
                rolesList.append(",");
            }
            // don't want to end with a "," so remove the last ","
            if (rolesList.length() &gt; 0)
                rolesList.replace(rolesList.length()-1, rolesList.length()+1, "");
            configAttrEditor.setAsText(rolesList.toString());
            return (ConfigAttributeDefinition) configAttrEditor.getValue();
        }
    }

    public Collection getConfigAttributeDefinitions() {
        return null;
    }

    public boolean supports(Class arg0) {
        return true;
    }

}
                </pre>
                <p>getAttributes()&#26041;&#27861;&#36820;&#22238;&#26435;&#38480;&#30340;&#21517;&#31216;&#65288;&#25105;&#31216;&#20043;&#20026;&#35282;&#33394;&#65289;&#65292;&#23427;&#20204;&#25511;&#21046;&#24403;&#21069;url&#30340;&#35775;&#38382;&#26435;&#38480;&#12290;</p>
            </li><li>
                <p>&#22909;&#20102;&#65292;&#29616;&#22312;&#25105;&#20204;&#38656;&#35201;&#23433;&#35013;&#20449;&#24687;&#25968;&#25454;&#24211;&#65292;&#19979;&#19968;&#27493;&#26159;&#35753;Spring Security&#20174;&#25968;&#25454;&#24211;&#20013;&#35835;&#21462;&#29992;&#25143;&#20449;&#24687;&#12290;&#36825;&#20010;Spring Security 2.0&#30340;&#20363;&#23376;&#21578;&#35785;&#20320;&#22914;&#20309;&#20174;&#19979;&#38754;&#36825;&#26679;&#30340;&#37197;&#32622;&#25991;&#20214;&#37324;&#33719;&#24471;&#29992;&#25143;&#21644;&#26435;&#38480;&#30340;&#21015;&#34920;&#65306;</p>
                <pre class="programlisting">
&lt;authentication-provider&gt;
    &lt;user-service&gt;
    &lt;user name="rod" password="password" authorities="ROLE_SUPERVISOR, ROLE_USER" /&gt;
    &lt;user name="dianne" password="password" authorities="ROLE_USER,ROLE_TELLER" /&gt;
    &lt;user name="scott" password="password" authorities="ROLE_USER" /&gt;
    &lt;user name="peter" password="password" authorities="ROLE_USER" /&gt;
    &lt;/user-service&gt;
&lt;/authentication-provider&gt;
                </pre>
                <p>&#20320;&#21487;&#20197;&#25226;&#36825;&#20123;&#20363;&#23376;&#30340;&#37197;&#32622;&#26367;&#25442;&#25481;&#65292;&#36825;&#26679;&#20320;&#21487;&#20197;&#20687;&#36825;&#26679;&#20174;&#25968;&#25454;&#24211;&#20013;&#30452;&#25509;&#35835;&#21462;&#29992;&#25143;&#20449;&#24687;&#65306;</p>
                <pre class="programlisting">
&lt;authentication-provider&gt;
    &lt;jdbc-user-service data-source-ref="dataSource" /&gt;
&lt;/authentication-provider&gt;
                </pre>
                <p>&#36825;&#37324;&#26377;&#19968;&#31181;&#38750;&#24120;&#24555;&#36895;&#23481;&#26131;&#30340;&#26041;&#27861;&#26469;&#37197;&#32622;&#23433;&#20840;&#25968;&#25454;&#24211;&#65292;&#24847;&#24605;&#26159;&#20320;&#38656;&#35201;&#20351;&#29992;&#40664;&#35748;&#30340;&#25968;&#25454;&#24211;&#34920;&#32467;&#26500;&#12290;&#40664;&#35748;&#24773;&#20917;&#19979;&#65292;&lt;jdbc-user-service&gt;&#38656;&#35201;&#19979;&#38754;&#30340;&#20960;&#20010;&#34920;&#65306;user,authorities,groups,group_members&#21644;group_authorities&#12290;</p>
                <p>&#25105;&#30340;&#24773;&#20917;&#19979;&#65292;&#25105;&#30340;&#23433;&#20840;&#25968;&#25454;&#24211;&#34920;&#26080;&#27861;&#36825;&#26679;&#24037;&#20316;&#65292;&#23427;&#21644;&lt;jdbc-user-service&gt;&#35201;&#27714;&#30340;&#19981;&#21516;&#65292;&#25152;&#20197;&#25105;&#38656;&#35201;&#20462;&#25913;&lt;authentication-provider&gt;&#65306;</p>
                <pre class="programlisting">
&lt;authentication-provider&gt;
    &lt;jdbc-user-service data-source-ref="dataSource"
    users-by-username-query="SELECT U.username, U.password, U.accountEnabled AS 'enabled' FROM User U where U.username=?"
    authorities-by-username-query="SELECT U.username, R.name as 'authority' FROM User U JOIN Authority A ON u.id = A.userId JOIN Role R ON R.id = A.roleId WHERE U.username=?"/&gt;
&lt;/authentication-provider&gt;
                </pre>
                <p>&#36890;&#36807;&#28155;&#21152;users-by-username-query&#21644;authorities-by-username-query&#23646;&#24615;&#65292;&#20320;&#21487;&#20197;&#20351;&#29992;&#20320;&#33258;&#24049;&#30340;SQL&#35206;&#30422;&#40664;&#35748;&#30340;SQL&#35821;&#21477;&#12290;&#23601;&#20687;&#22312;acegi&#20013;&#19968;&#26679;&#65292;&#20320;&#24517;&#39035;&#30830;&#20445;&#20320;&#30340;SQL&#35821;&#21477;&#36820;&#22238;&#30340;&#21015;&#19982;Spring Security&#25152;&#26399;&#24453;&#30340;&#19968;&#26679;&#12290;&#36825;&#37324;&#26377;&#21478;&#19968;&#20010;group-authorities-by-username-query&#23646;&#24615;&#65292;&#25105;&#22312;&#36825;&#37324;&#27809;&#26377;&#29992;&#21040;&#65292;&#25152;&#20197;&#20063;&#27809;&#26377;&#20986;&#29616;&#22312;&#36825;&#37324;&#20363;&#23376;&#20013;&#65292;&#19981;&#36807;&#23427;&#30340;&#29992;&#27861;&#19982;&#20854;&#20182;&#20004;&#20010;SQl&#35821;&#21477;&#30340;&#26041;&#27861;&#23436;&#20840;&#19968;&#33268;&#12290;</p>
                <p>&lt;jdbc-user-service&gt;&#30340;&#36825;&#20123;&#21151;&#33021;&#22823;&#27010;&#26159;&#22312;&#19978;&#20010;&#26376;&#25165;&#21152;&#20837;&#30340;&#65292;&#22312;Spring Security&#20043;&#21069;&#29256;&#26412;&#20013;&#26159;&#26080;&#27861;&#20351;&#29992;&#30340;&#12290;&#24184;&#36816;&#30340;&#26159;&#23427;&#24050;&#32463;&#34987;&#21152;&#20837;&#21040;Spring Security&#20013;&#20102;&#65292;&#36825;&#35753;&#25105;&#20204;&#30340;&#24037;&#20316;&#26356;&#21152;&#31616;&#21333;&#12290;&#20320;&#21487;&#20197;&#36890;&#36807; <a xmlns:xlink="http://www.w3.org/1999/xlink" href="javascript:if(confirm('http://www.jroller.com/habuma/entry/roadrantz_and_spring_security_2  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://www.jroller.com/habuma/entry/roadrantz_and_spring_security_2'" tppabs="http://www.jroller.com/habuma/entry/roadrantz_and_spring_security_2" target="_top">&#36825;&#37324;</a>&#21644;<a xmlns:xlink="http://www.w3.org/1999/xlink" href="javascript:if(confirm('http://www.jroller.com/habuma/entry/spring_security_and_custom_user  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://www.jroller.com/habuma/entry/spring_security_and_custom_user'" tppabs="http://www.jroller.com/habuma/entry/spring_security_and_custom_user" target="_top">&#36825;&#37324;</a>&#33719;&#21462;&#20449;&#24687;&#12290;</p>
                <p>dataSource bean&#20013;&#25351;&#31034;&#30340;&#26159;&#38142;&#25509;&#25968;&#25454;&#24211;&#30340;&#20449;&#24687;&#65292;&#23427;&#27809;&#26377;&#21253;&#21547;&#22312;&#25105;&#30340;&#37197;&#32622;&#25991;&#20214;&#20013;&#65292;&#22240;&#20026;&#23427;&#24182;&#19981;&#21482;&#29992;&#22312;&#23433;&#20840;&#20013;&#12290;&#36825;&#37324;&#26159;&#19968;&#20010;dataSource&#30340;&#20363;&#23376;&#65292;&#22914;&#26524;&#35841;&#19981;&#29087;&#24713;&#21487;&#20197;&#21442;&#32771;&#19968;&#19979;&#65306;</p>
                <pre class="programlisting">
&lt;bean id="dataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource"&gt;
    &lt;property name="driverClassName" value="com.mysql.jdbc.Driver"/&gt;
    &lt;property name="url" value="jdbc:mysql://localhost/db_name?useUnicode=true&amp;characterEncoding=utf-8"/&gt;
    &lt;property name="username" value="root"/&gt;
    &lt;property name="password" value="pwd"/&gt;
&lt;/bean&gt;
                </pre>
            </li><li>
                <p>&#36825;&#23601;&#26159;Spring Security&#30340;&#25152;&#26377;&#37197;&#32622;&#25991;&#20214;&#12290;&#25105;&#26368;&#21518;&#19968;&#39033;&#20219;&#21153;&#26159;&#20462;&#25913;&#20197;&#21069;&#30340;&#30331;&#38470;&#39029;&#38754;&#12290;&#22312;acegi&#20013;&#20320;&#21487;&#20197;&#21019;&#24314;&#33258;&#24049;&#30340;&#30331;&#38470;&lt;form&gt;&#65292;&#21521;&#27491;&#30830;&#30340;URL&#21457;&#36865;&#27491;&#30830;&#21629;&#21517;&#30340;HTML&#36755;&#20837;&#20803;&#32032;&#12290;&#29616;&#22312;&#20320;&#20063;&#21487;&#20197;&#22312;Spring Security 2.0&#37324;&#36825;&#26679;&#20570;&#65292;&#21482;&#26159;&#19968;&#20123;&#21517;&#31216;&#21457;&#29983;&#20102;&#25913;&#21464;&#12290;&#20320;&#21487;&#20197;&#20687;&#20197;&#21069;&#19968;&#26679;&#20351;&#29992;&#29992;&#25143;&#21517;j_username&#21644;&#23494;&#30721;j_password&#12290;</p>
                <pre class="programlisting">
&lt;input type="text" name="j_username" id="j_username"/&gt;
&lt;input type="password" name="j_password" id="j_password"/&gt;
                </pre>
                <p>&#20294;&#26159;&#20320;&#24517;&#39035;&#25226;&lt;form&gt;&#20013;&#30340;action&#25351;&#21521;j_spring_security_check&#32780;&#19981;&#26159;j_acegi_security_check&#12290;</p>
                <pre class="programlisting">
&lt;form method="post" id="loginForm" action="&lt;c:url value='j_spring_security_check'/&gt;"
                </pre>
                <p>&#22312;&#20320;&#30340;&#24212;&#29992;&#20013;&#26377;&#19968;&#20123;&#22320;&#26041;&#65292;&#29992;&#25143;&#21487;&#20197;&#36827;&#34892;&#27880;&#38144;&#65292;&#36825;&#26159;&#19968;&#20010;&#38142;&#25509;&#25226;&#27880;&#38144;&#35831;&#27714;&#21457;&#36865;&#32473;&#23433;&#20840;&#26694;&#26550;&#65292;&#36825;&#26679;&#23427;&#23601;&#21487;&#20197;&#36827;&#34892;&#30456;&#24212;&#30340;&#22788;&#29702;&#12290;&#38656;&#35201;&#25226;&#23427;&#20174;j_acegi_logout&#25913;&#25104;j_spring_security_logout&#12290;</p>
                <pre class="programlisting">
&lt;a href='&lt;c:url value="j_spring_security_logout"/&gt;'&gt;Logout&lt;/a&gt;
                </pre>
            </li></ol></div>
    </div>

    <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="z-p-conclusion"></a>25.4.&nbsp;&#24635;&#32467;</h2></div></div></div>
        
        <p>&#36825;&#20010;&#31616;&#30701;&#30340;&#25351;&#21335;&#65292;&#21253;&#21547;&#20102;&#22914;&#20309;&#37197;&#32622;Spring Security 2.0&#20351;&#29992;&#25968;&#25454;&#24211;&#20013;&#30340;&#36164;&#28304;&#65292;&#23427;&#24182;&#27809;&#26377;&#28436;&#31034;Spring Security 2.0&#20013;&#30340;&#26032;&#29305;&#24615;&#65292;&#28982;&#32780;&#25105;&#24819;&#23427;&#21487;&#20197;&#28436;&#31034;&#19968;&#20123;&#38750;&#24120;&#24120;&#29992;&#30340;&#26694;&#26550;&#21151;&#33021;&#65292;&#25105;&#24076;&#26395;&#20320;&#20204;&#35273;&#24471;&#23427;&#26377;&#29992;&#12290;</p>
        <p>Spring Security 2.0&#19982;acegi&#30456;&#27604;&#30340;&#22909;&#22788;&#20043;&#19968;&#26159;&#37197;&#32622;&#25991;&#20214;&#38750;&#24120;&#31616;&#21333;&#65292;&#36825;&#22312;&#25105;&#27604;&#36739;&#32769;acegi&#37197;&#32622;&#25991;&#20214;&#65288;172&#34892;&#65289;&#21644;&#26032;&#37197;&#32622;&#25991;&#20214;&#65288;42&#34892;&#65289;&#30340;&#26102;&#20505;&#65292;&#28165;&#26970;&#30340;&#26174;&#31034;&#20986;&#36335;&#29233;&#12290;</p>
        <p>&#36825;&#37324;&#26159;&#25105;&#23436;&#25972;&#30340;securityContext.xml&#25991;&#20214;&#65306;</p>
        <pre class="programlisting">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans:beans xmlns="http://www.springframework.org/schema/security"
xmlns:beans="http://www.springframework.org/schema/beans"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://www.springframework.org/schema/beans,http://www.springframework.org/schema/beans/spring-beans-2.0.xsd,http://www.springframework.org/schema/security,http://www.springframework.org/schema/security/spring-security-2.0.xsd"&gt;

	&lt;authentication-manager alias="authenticationManager"/&gt;

	&lt;beans:bean id="accessDecisionManager" class="org.springframework.security.vote.AffirmativeBased"&gt;
		&lt;beans:property name="allowIfAllAbstainDecisions" value="false"/&gt;
		&lt;beans:property name="decisionVoters"&gt;
			&lt;beans:list&gt;
				&lt;beans:bean class="org.springframework.security.vote.RoleVoter"/&gt;
				&lt;beans:bean class="org.springframework.security.vote.AuthenticatedVoter"/&gt;
			&lt;/beans:list&gt;
		&lt;/beans:property&gt;
	&lt;/beans:bean&gt;

	&lt;beans:bean id="filterInvocationInterceptor" class="org.springframework.security.intercept.web.FilterSecurityInterceptor"&gt;
		&lt;beans:property name="authenticationManager" ref="authenticationManager"/&gt;
		&lt;beans:property name="accessDecisionManager" ref="accessDecisionManager"/&gt;
		&lt;beans:property name="objectDefinitionSource" ref="secureResourceFilter" /&gt;
	&lt;/beans:bean&gt;

	&lt;beans:bean id="secureResourceFilter" class="org.security.SecureFilter.MySecureResourceFilter" /&gt;

	&lt;http auto-config="true" access-denied-page="/403.jsp"&gt;
		&lt;concurrent-session-control max-sessions="1" exception-if-maximum-exceeded="true" /&gt;
		&lt;form-login login-page="/login.jsp" authentication-failure-url="/login.jsp" default-target-url="/index.jsp" /&gt;
		&lt;logout logout-success-url="/login.jsp"/&gt;
	&lt;/http&gt;

	&lt;beans:bean id="loggerListener" class="org.springframework.security.event.authentication.LoggerListener"/&gt;

	&lt;authentication-provider&gt;
		&lt;jdbc-user-service data-source-ref="dataSource" users-by-username-query="SELECT U.username, U.password, U.accountEnabled AS 'enabled' FROM User U where U.username=?" authorities-by-username-query="SELECT U.username, R.name as 'authority' FROM User U JOIN Authority A ON u.id = A.userId JOIN Role R ON R.id = A.roleId WHERE U.username=?" /&gt;
	&lt;/authentication-provider&gt;
&lt;/beans:beans&gt;
        </pre>
        <p>&#23601;&#20687;&#22312;&#31532;&#19968;&#27493;&#26102;&#25552;&#21040;&#21040;&#65292;&#19979;&#36733;Spring Security&#26159;&#26368;&#37325;&#35201;&#30340;&#27493;&#39588;&#12290;&#20174;&#37027;&#37324;&#24320;&#22987;&#23601;&#21487;&#20197;&#19968;&#24070;&#39118;&#39034;&#20102;&#12290;</p>
    </div>


</div><div xmlns:fo="http://www.w3.org/1999/XSL/Format" class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="domain-acls.html" tppabs="http://www.family168.com/tutorial/springsecurity/html/domain-acls.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="springsecurity.html" tppabs="http://www.family168.com/tutorial/springsecurity/html/springsecurity.html">Home</a></td><td width="40%" align="right">&nbsp;</td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;24.&nbsp;&#39046;&#22495;&#23545;&#35937;&#23433;&#20840;&nbsp;</td><td width="20%" align="center"><span style="color:white;font-size:90%;"><a href="javascript:if(confirm('http://www.springsource.com/  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://www.springsource.com/'" tppabs="http://www.springsource.com/" title="SpringSource">Sponsored by SpringSource
                                        </a></span></td><td width="40%" align="right" valign="top">&nbsp;</td></tr></table></div></body></html><script type="text/javascript">var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www./");document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));</script><script type="text/javascript">var pageTracker = _gat._getTracker("UA-2857097-3");pageTracker._initData();pageTracker._trackPageview();</script>