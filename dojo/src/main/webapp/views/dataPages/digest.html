<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;13.&nbsp;&#25688;&#35201;&#24335;&#35748;&#35777;</title><link rel="stylesheet" href="html.css" tppabs="http://www.family168.com/tutorial/springsecurity/html/css/html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.72.0"><link rel="start" href="springsecurity.html" title="Spring Security"><link rel="up" href="authentication.html" title="Part&nbsp;III.&nbsp;&#35748;&#35777;"><link rel="prev" href="basic.html" title="Chapter&nbsp;12.&nbsp;&#22522;&#26412;&#35748;&#35777;&#26426;&#21046;"><link rel="next" href="remember-me.html" title="Chapter&nbsp;14.&nbsp;Remember-Me&#35748;&#35777;"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div xmlns:fo="http://www.w3.org/1999/XSL/Format" style="background-color:white;border:none;height:73px;border:1px solid black;"><a style="border:none;" href="javascript:if(confirm('http://static.springframework.org/spring-ws/site/  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://static.springframework.org/spring-ws/site/'" tppabs="http://static.springframework.org/spring-ws/site/" title="The Spring Framework - Spring Web Services"><img style="border:none;" src="xdev-spring_logo.jpg" tppabs="http://www.family168.com/tutorial/springsecurity/html/images/xdev-spring_logo.jpg"></a><a style="border:none;" href="javascript:if(confirm('http://www.springsource.com/  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://www.springsource.com/'" tppabs="http://www.springsource.com/" title="SpringSource"><img style="border:none;position:absolute;padding-top:5px;right:42px;" src="s2-banner-rhs.png" tppabs="http://www.family168.com/tutorial/springsecurity/html/images/s2-banner-rhs.png"></a></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h1 class="title"><a name="digest"></a>&#25688;&#35201;&#24335;&#35748;&#35777;</h1></div></div></div>


    <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="digest-overview"></a>13.1.&nbsp;&#27010;&#36848;</h2></div></div></div>


        <p>Spring Security&#25552;&#20379;&#20102;&#19968;&#20010;
            <code class="literal">DigestProcessingFilter</code>&#65292;&#23427;&#21487;&#20197;&#22788;&#29702;HTTP&#22836;&#37096;&#20013;&#30340;&#25688;&#35201;&#35748;&#35777;&#35777;&#20070;&#12290;
            &#25688;&#35201;&#35748;&#35777;&#22312;&#23581;&#35797;&#30528;&#35299;&#20915;&#35768;&#22810;&#22522;&#26412;&#35748;&#35777;&#30340;&#32570;&#38519;&#65292;&#29305;&#21035;&#26159;&#20445;&#35777;&#19981;&#20250;&#36890;&#36807;&#32431;&#25991;&#26412;&#21457;&#36865;&#35777;&#20070;&#12290;
            &#35768;&#22810;&#29992;&#25143;&#25903;&#25345;&#25688;&#35201;&#24335;&#35748;&#35777;&#65292;&#21253;&#25324;FireFox&#21644;IE&#12290;
            HTTP&#25688;&#35201;&#24335;&#35748;&#35777;&#30340;&#25191;&#34892;&#26631;&#20934;&#23450;&#20041;&#22312;RFC 2617&#65292;&#23427;&#26159;&#23545;RFC 2069&#36825;&#20010;&#26089;&#26399;&#25688;&#35201;&#24335;&#35748;&#35777;&#26631;&#20934;&#30340;&#26356;&#26032;&#12290;
            Spring Security <code class="literal">DigestProcessingFilter</code>&#20250;&#20445;&#35777;"<code class="literal">auth</code>"&#30340;&#23433;&#20840;&#36136;&#37327;&#65288;<code class="literal">qop</code>&#65289;&#65292;&#23427;&#35746;&#26126;&#22312;RFC 2617&#20013;&#65292;&#24182;&#19982;RFC 2069&#25552;&#20379;&#20102;&#20860;&#23481;&#12290;
            &#22914;&#26524;&#20320;&#38656;&#35201;&#20351;&#29992;&#27809;&#26377;&#21152;&#23494;&#30340;HTTP&#65288;&#27604;&#22914;&#27809;&#26377;TLS/HTTP&#65289;&#65292;&#36824;&#24076;&#26395;&#35748;&#35777;&#36798;&#21040;&#26368;&#22823;&#30340;&#23433;&#20840;&#24615;&#30340;&#26102;&#20505;&#65292;&#25688;&#35201;&#24335;&#35748;&#35777;&#20415;&#20855;&#26377;&#24456;&#39640;&#21560;&#24341;&#21147;&#12290;
            &#20107;&#23454;&#19978;&#65292;&#25688;&#35201;&#24335;&#35748;&#35777;&#26159;WebDAV&#21327;&#35758;&#30340;&#24378;&#21046;&#24615;&#35201;&#27714;&#65292;&#20889;&#22312;RFC 2518&#30340;17.1&#31456;&#65292;&#25152;&#20197;&#25105;&#20204;&#24212;&#35813;&#26399;&#26395;&#30475;&#21040;&#26356;&#22810;&#30340;&#20195;&#26367;&#22522;&#26412;&#35748;&#35777;&#12290;</p>

        <p>&#25688;&#35201;&#24335;&#35748;&#35777;&#65292;&#26159;&#34920;&#21333;&#35748;&#35777;&#65292;&#22522;&#26412;&#35748;&#35777;&#21644;&#25688;&#35201;&#24335;&#35748;&#35777;&#20013;&#26368;&#23433;&#20840;&#30340;&#36873;&#25321;&#65292;&#19981;&#36807;&#26356;&#23433;&#20840;&#20063;&#24847;&#21619;&#30528;&#26356;&#22797;&#26434;&#30340;&#29992;&#25143;&#20195;&#29702;&#23454;&#29616;&#12290;
            &#25688;&#35201;&#24335;&#35748;&#35777;&#30340;&#20013;&#24515;&#26159;&#19968;&#20010;&#8220;nonce&#8221;&#12290;
            &#36825;&#26159;&#30001;&#26381;&#21153;&#22120;&#29983;&#25104;&#30340;&#19968;&#20010;&#20540;&#12290;
            Spring Security&#30340;nonce&#37319;&#29992;&#19979;&#38754;&#30340;&#26684;&#24335;&#65306;</p>

        <pre class="programlisting">
    base64(expirationTime + ":" + md5Hex(expirationTime + ":" + key))

    expirationTime:   The date and time when the nonce expires, expressed in milliseconds
    key:              A private key to prevent modification of the nonce token
        </pre>

        <p>&#36825;&#20010;<code class="literal">DigestProcessingFilterEntryPoint</code>&#26377;&#19968;&#20010;&#23646;&#24615;&#65292;&#36890;&#36807;&#25351;&#23450;&#19968;&#20010;<code class="literal">key</code>&#26469;&#29983;&#25104;nonce&#26631;&#24535;&#65292;&#36890;&#36807;<code class="literal">nonceValiditySeconds</code>&#23646;&#24615;&#26469;&#20915;&#23450;&#36807;&#26399;&#26102;&#38388;&#65288;&#40664;&#35748;300&#65292;&#31561;&#20110;5&#20998;&#38047;&#65289;&#12290;
            &#21482;&#35201;nonce&#26159;&#26377;&#25928;&#30340;&#65292;&#25688;&#35201;&#23601;&#20250;&#36890;&#36807;&#20018;&#32852;&#23383;&#31526;&#20018;&#35745;&#31639;&#20986;&#26469;&#65292;&#21253;&#25324;&#29992;&#25143;&#21517;&#65292;&#23494;&#30721;&#65292;nonce&#65292;&#35831;&#27714;&#30340;URI&#65292;&#19968;&#20010;&#23458;&#25143;&#31471;&#29983;&#25104;nonce&#65288;&#20165;&#20165;&#26159;&#19968;&#20010;&#38543;&#26426;&#20540;&#65292;&#29992;&#25143;&#20195;&#29702;&#27599;&#20010;&#35831;&#27714;&#29983;&#25104;&#19968;&#20010;&#65289;&#65292;realm&#21517;&#31216;&#31561;&#31561;&#65292;&#28982;&#21518;&#25191;&#34892;&#19968;&#27425;MD5&#25955;&#21015;&#12290;
            &#26381;&#21153;&#22120;&#21644;&#29992;&#25143;&#20195;&#29702;&#37117;&#35201;&#25191;&#34892;&#36825;&#20010;&#25688;&#35201;&#35745;&#31639;&#65292;&#22914;&#26524;&#20182;&#20204;&#21253;&#21547;&#30340;&#20540;&#19981;&#21516;&#65288;&#27604;&#22914;&#23494;&#30721;&#65289;&#65292;&#23601;&#20250;&#29983;&#25104;&#19981;&#21516;&#30340;&#25955;&#21015;&#30721;&#12290;
            &#22312;Spring Security&#30340;&#23454;&#29616;&#20013;&#65292;&#22914;&#26524;&#26381;&#21153;&#22120;&#29983;&#25104;&#30340;nonce&#24050;&#32463;&#36807;&#26399;&#65288;&#20294;&#26159;&#25688;&#35201;&#36824;&#26159;&#26377;&#25928;&#65289;&#65292;<code class="literal">DigestProcessingFilterEntryPoint</code>&#20250;&#21457;&#36865;&#19968;&#20010;<code class="literal">"stale=true"</code>&#22836;&#20449;&#24687;&#12290;
            &#36825;&#21578;&#35785;&#29992;&#25143;&#20195;&#29702;&#65292;&#36825;&#37324;&#19981;&#20877;&#38656;&#35201;&#25171;&#25200;&#29992;&#25143;&#65288;&#20687;&#26159;&#23494;&#30721;&#21644;&#29992;&#25143;&#20854;&#20182;&#37117;&#26159;&#27491;&#30830;&#30340;&#65289;&#65292;&#21482;&#26159;&#31616;&#21333;&#23581;&#35797;&#20351;&#29992;&#19968;&#20010;&#26032;nonce&#12290;</p>

        <p>
            <code class="literal">DigestProcessingFilterEntryPoint</code>&#30340;
            <code class="literal">nonceValiditySeconds</code>&#21442;&#25968;&#65292;&#20250;&#20316;&#20026;&#19968;&#20010;&#36866;&#24403;&#30340;&#20540;&#20381;&#38468;&#22312;&#20320;&#30340;&#31243;&#24207;&#19978;&#12290;
            &#23545;&#23433;&#20840;&#35201;&#27714;&#24456;&#39640;&#30340;&#29992;&#25143;&#24212;&#35813;&#27880;&#24847;&#65292;&#19968;&#20010;&#34987;&#25318;&#25130;&#30340;&#35748;&#35777;&#22836;&#37096;&#21487;&#20197;&#29992;&#26469;&#20551;&#20882;&#20027;&#20307;&#65292;&#30452;&#21040;nonce&#36798;&#21040;<code class="literal">expirationTime</code>&#12290;
            &#22312;&#36873;&#25321;&#21512;&#36866;&#30340;&#37197;&#32622;&#30340;&#26102;&#20505;&#65292;&#36825;&#26159;&#19968;&#20010;&#24517;&#39035;&#32771;&#34385;&#21040;&#30340;&#20851;&#38190;&#24615;&#26465;&#20214;&#65292;&#20294;&#26159;&#22312;&#23545;&#23433;&#20840;&#24615;&#35201;&#27714;&#24456;&#39640;&#30340;&#31243;&#24207;&#37324;&#65292;&#31532;&#19968;&#27425;&#35831;&#27714;&#37117;&#20250;&#39318;&#20808;&#36816;&#34892;&#22312;TLS/HTTPS&#20043;&#19978;&#12290;</p>

        <p>&#22240;&#20026;&#25688;&#35201;&#24335;&#35748;&#35777;&#38656;&#35201;&#26356;&#22797;&#26434;&#30340;&#23454;&#29616;&#65292;&#36825;&#37324;&#24120;&#24120;&#26377;&#29992;&#25143;&#20195;&#29702;&#30340;&#38382;&#39064;&#12290;
            &#27604;&#22914;&#65292;IE&#19981;&#33021;&#22312;&#21516;&#19968;&#20010;&#20250;&#35805;&#30340;&#35831;&#27714;&#36827;&#31243;&#37324;&#38459;&#27490;"<code class="literal">&#36879;&#26126;</code>"&#26631;&#24535;&#12290;
            &#22240;&#27492;Spring Security&#25226;&#25152;&#26377;&#29366;&#24577;&#20449;&#24687;&#37117;&#27010;&#25324;&#21040;"<code class="literal">nonce</code>"&#26631;&#35760;&#37324;&#12290;
            &#22312;&#25105;&#20204;&#30340;&#27979;&#35797;&#20013;&#65292;Spring Security&#22312;FireFox&#21644;IE&#37324;&#37117;&#21487;&#20197;&#24037;&#20316;&#65292;&#27491;&#30830;&#30340;&#22788;&#29702;nonce&#36229;&#26102;&#31561;&#31561;&#12290;</p>
    </div>

    <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="digest-config"></a>13.2.&nbsp;&#37197;&#32622;</h2></div></div></div>


        <p>&#29616;&#22312;&#25105;&#20204;&#37325;&#26032;&#30475;&#19968;&#19979;&#29702;&#35770;&#65292;&#35753;&#25105;&#20204;&#30475;&#30475;&#22914;&#20309;&#20351;&#29992;&#23427;&#12290;
            &#20026;&#20102;&#23454;&#29616;HTTP&#25688;&#35201;&#35748;&#35777;&#65292;&#24517;&#39035;&#22312;&#36807;&#28388;&#22120;&#38142;&#37324;&#23450;&#20041;<code class="literal">DigestProcessingFilter</code>&#12290;
            application context&#36824;&#38656;&#35201;&#23450;&#20041;<code class="literal">DigestProcessingFilter</code>&#21644;&#23427;&#38656;&#35201;&#30340;&#21512;&#20316;&#20249;&#20276;&#65306;</p>

        <pre class="programlisting">

&lt;bean id="digestProcessingFilter"
    class="org.springframework.security.ui.digestauth.DigestProcessingFilter"&gt;
  &lt;property name="userDetailsService" ref="jdbcDaoImpl"/&gt;
  &lt;property name="authenticationEntryPoint" ref="digestProcessingFilterEntryPoint"/&gt;
  &lt;property name="userCache" ref="userCache"/&gt;
&lt;/bean&gt;

&lt;bean id="digestProcessingFilterEntryPoint"
    class="org.springframework.security.ui.digestauth.DigestProcessingFilterEntryPoint"&gt;
  &lt;property name="realmName" value="Contacts Realm via Digest Authentication"/&gt;
  &lt;property name="key" value="acegi"/&gt;
  &lt;property name="nonceValiditySeconds" value="10"/&gt;
&lt;/bean&gt;

        </pre>

        <p>&#38656;&#35201;&#37197;&#32622;&#19968;&#20010;<code class="literal">UserDetailsService</code>&#65292;&#22240;&#20026;
            <code class="literal">DigestProcessingFilter</code>&#24517;&#39035;&#30452;&#25509;&#35775;&#38382;&#29992;&#25143;&#30340;&#32431;&#25991;&#26412;&#23494;&#30721;&#12290;
            &#22914;&#26524;&#20320;&#22312;DAO&#20013;&#20351;&#29992;&#32534;&#30721;&#36807;&#30340;&#23494;&#30721;&#65292;&#25688;&#35201;&#24335;&#35748;&#35777;&#23601;&#27809;&#27861;&#24037;&#20316;&#12290;
            DAO&#21512;&#20316;&#32773;&#65292;&#19982;<code class="literal">UserCache</code>&#19968;&#36215;&#65292;&#36890;&#24120;&#20351;&#29992;<code class="literal">DaoAuthenticationProvider</code>&#30452;&#25509;&#20849;&#20139;&#12290;
            &#36825;&#20010;<code class="literal">authenticationEntryPoint</code>&#23646;&#24615;&#24517;&#39035;&#26159;<code class="literal">DigestProcessingFilterEntryPoint</code>&#65292;&#36825;&#26679;<code class="literal">DigestProcessingFilter</code>&#21487;&#20197;&#22312;&#36827;&#34892;&#25688;&#35201;&#35745;&#31639;&#26102;&#33719;&#24471;&#27491;&#30830;&#30340;<code class="literal">realmName</code>&#21644;<code class="literal">key</code>&#12290;</p>

        <p>&#20687;<code class="literal">BasicAuthenticationFilter</code>&#19968;&#26679;&#65292;&#22914;&#26524;&#35748;&#35777;&#25104;&#21151;&#65292;&#20250;&#25226;<code class="literal">Authentication</code>&#35831;&#27714;&#26631;&#35760;&#25918;&#21040;<code class="literal">SecurityContextHolder</code>&#20013;&#12290;
            &#22914;&#26524;&#35748;&#35777;&#20107;&#20214;&#25104;&#21151;&#65292;&#25110;&#32773;&#35748;&#35777;&#19981;&#38656;&#35201;&#25191;&#34892;&#65292;&#22240;&#20026;HTTP&#22836;&#37096;&#27809;&#26377;&#21253;&#21547;&#25688;&#35201;&#35748;&#35777;&#35831;&#27714;&#65292;&#36807;&#28388;&#22120;&#38142;&#20250;&#27491;&#24120;&#32487;&#32493;&#12290;
            &#36807;&#28388;&#22120;&#38142;&#20013;&#26029;&#30340;&#21807;&#19968;&#24773;&#20917;&#26159;&#65292;&#22914;&#26524;&#35748;&#35777;&#22833;&#36133;&#65292;&#23601;&#20250;&#20687;&#19978;&#38754;&#35752;&#35770;&#30340;&#37027;&#26679;&#35843;&#29992;<code class="literal">AuthenticationEntryPoint</code>&#12290;</p>

        <p>&#25688;&#35201;&#24335;&#35748;&#35777;&#30340;RFC&#35201;&#27714;&#38468;&#21152;&#21151;&#33021;&#33539;&#22260;&#65292;&#26469;&#26356;&#22909;&#30340;&#25552;&#21319;&#23433;&#20840;&#24615;&#12290;
            &#27604;&#22914;&#65292;nonce&#21487;&#20197;&#22312;&#27599;&#27425;&#35831;&#27714;&#30340;&#26102;&#20505;&#21464;&#25442;&#12290;
            &#20294;&#26159;&#65292;Spring Security&#30340;&#35774;&#35745;&#24605;&#36335;&#26159;&#26368;&#23567;&#22797;&#26434;&#24615;&#30340;&#23454;&#29616;&#65288;&#27627;&#26080;&#30097;&#38382;&#65292;&#29992;&#25143;&#20195;&#29702;&#20250;&#20986;&#29616;&#19981;&#20860;&#23481;&#65289;&#65292;&#20063;&#36991;&#20813;&#20445;&#23384;&#26381;&#21153;&#22120;&#31471;&#30340;&#29366;&#24577;&#12290;
            &#22914;&#26524;&#20320;&#24819;&#30740;&#31350;&#36825;&#20123;&#21151;&#33021;&#30340;&#26356;&#22810;&#32454;&#33410;&#65292;&#25105;&#20204;&#25512;&#33616;&#20320;&#30475;&#19968;&#19979;RFC 2617&#12290;
            &#20687;&#25105;&#20204;&#30693;&#36947;&#30340;&#37027;&#26679;&#65292;Spring Security&#23454;&#29616;&#31867;&#36981;&#23432;&#20102;RFC&#30340;&#26368;&#20302;&#26631;&#20934;&#12290;</p>
    </div>
</div><div xmlns:fo="http://www.w3.org/1999/XSL/Format" class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="basic.html" tppabs="http://www.family168.com/tutorial/springsecurity/html/basic.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="springsecurity.html" tppabs="http://www.family168.com/tutorial/springsecurity/html/springsecurity.html">Home</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="remember-me.html" tppabs="http://www.family168.com/tutorial/springsecurity/html/remember-me.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;12.&nbsp;&#22522;&#26412;&#35748;&#35777;&#26426;&#21046;&nbsp;</td><td width="20%" align="center"><span style="color:white;font-size:90%;"><a href="javascript:if(confirm('http://www.springsource.com/  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://www.springsource.com/'" tppabs="http://www.springsource.com/" title="SpringSource">Sponsored by SpringSource
                                        </a></span></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;14.&nbsp;Remember-Me&#35748;&#35777;</td></tr></table></div></body></html><script type="text/javascript">var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www./");document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));</script><script type="text/javascript">var pageTracker = _gat._getTracker("UA-2857097-3");pageTracker._initData();pageTracker._trackPageview();</script>