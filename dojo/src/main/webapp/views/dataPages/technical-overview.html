<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;5.&nbsp;&#25216;&#26415;&#27010;&#36848;</title><link rel="stylesheet" href="html.css" tppabs="http://www.family168.com/tutorial/springsecurity/html/css/html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.72.0"><link rel="start" href="springsecurity.html" title="Spring Security"><link rel="up" href="overall-architecture.html" title="Part&nbsp;II.&nbsp;&#24635;&#20307;&#32467;&#26500;"><link rel="prev" href="overall-architecture.html" title="Part&nbsp;II.&nbsp;&#24635;&#20307;&#32467;&#26500;"><link rel="next" href="supporting-infrastructure.html" title="Chapter&nbsp;6.&nbsp;&#25903;&#25345;&#30340;&#22522;&#30784;&#35774;&#26045;"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div xmlns:fo="http://www.w3.org/1999/XSL/Format" style="background-color:white;border:none;height:73px;border:1px solid black;"><a style="border:none;" href="javascript:if(confirm('http://static.springframework.org/spring-ws/site/  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://static.springframework.org/spring-ws/site/'" tppabs="http://static.springframework.org/spring-ws/site/" title="The Spring Framework - Spring Web Services"><img style="border:none;" src="xdev-spring_logo.jpg" tppabs="http://www.family168.com/tutorial/springsecurity/html/images/xdev-spring_logo.jpg"></a><a style="border:none;" href="javascript:if(confirm('http://www.springsource.com/  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://www.springsource.com/'" tppabs="http://www.springsource.com/" title="SpringSource"><img style="border:none;position:absolute;padding-top:5px;right:42px;" src="s2-banner-rhs.png" tppabs="http://www.family168.com/tutorial/springsecurity/html/images/s2-banner-rhs.png"></a></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h1 class="title"><a name="technical-overview"></a>&#25216;&#26415;&#27010;&#36848;</h1></div></div></div>

  

  <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="runtime-environment"></a>5.1.&nbsp;&#36816;&#34892;&#29615;&#22659;</h2></div></div></div>
    

    <p>Spring Security&#21487;&#20197;&#36816;&#34892;&#22312;&#26631;&#20934;&#30340;Java 1.4&#36816;&#34892;&#29615;&#22659;&#19979;&#12290;
    &#23427;&#20063;&#25903;&#25345;Java 5.0&#65292;&#19981;&#36807;&#36825;&#37096;&#20998;&#20195;&#30721;&#21333;&#29420;&#25171;&#21253;&#36215;&#26469;&#65292;&#25918;&#21040;&#21457;&#24067;&#30340;&#65292;&#25991;&#20214;&#21517;&#26159;"tiger"&#21069;&#32512;&#30340;JAR&#25991;&#20214;&#37324;&#12290;
    &#22240;&#20026;Spring Security&#30340;&#30446;&#26631;&#26159;&#33258;&#24049;&#23481;&#22120;&#20869;&#31649;&#29702;&#65292;&#25152;&#20197;&#19981;&#38656;&#35201;&#20026;&#20320;&#30340;Java&#36816;&#34892;&#29615;&#22659;&#36827;&#34892;&#20160;&#20040;&#29305;&#21035;&#30340;&#37197;&#32622;&#12290;
    &#29305;&#21035;&#26159;&#65292;&#19981;&#38656;&#35201;&#29305;&#21035;&#37197;&#32622;&#19968;&#20010;Java Authentication and Authorization Service (JAAS)&#25919;&#31574;&#25991;&#20214;&#65292;&#20063;&#19981;&#38656;&#35201;&#25226;Spring Security&#25918;&#21040;server&#30340;classLoader&#19979;&#12290;</p>

    <p>&#36825;&#20123;&#35774;&#35745;&#30830;&#20445;&#20102;&#21457;&#24067;&#26102;&#30340;&#26368;&#22823;&#36731;&#20415;&#24615;&#65292;&#20320;&#21487;&#20197;&#31616;&#21333;&#25226;&#20320;&#30340;&#30446;&#26631;&#25991;&#20214;&#65288;JAR&#25110;WAR&#25110;EAR&#65289;&#20174;&#19968;&#20010;&#31995;&#32479;&#22797;&#21046;&#21040;&#21478;&#19968;&#20010;&#31995;&#32479;&#65292;&#23427;&#20250;&#31435;&#21363;&#27491;&#24120;&#24037;&#20316;&#12290;</p>
  </div>

  <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="shared-components"></a>5.2.&nbsp;&#20849;&#20139;&#32452;&#20214;</h2></div></div></div>
    

    <p>&#35753;&#25105;&#20204;&#23637;&#31034;&#19968;&#20123;Spring Security&#20013;&#24456;&#37325;&#35201;&#30340;&#20849;&#20139;&#32452;&#20214;&#12290;
    &#34987;&#25104;&#20026;"shared"&#30340;&#32452;&#20214;&#65292;&#26159;&#25351;&#23427;&#22312;&#26694;&#26550;&#20013;&#21344;&#26377;&#24456;&#37325;&#35201;&#30340;&#20301;&#32622;&#65292;&#26694;&#26550;&#31163;&#24320;&#23427;&#20204;&#23601;&#27809;&#27861;&#36816;&#34892;&#12290;
    &#36825;&#20123;java&#31867;&#34920;&#36798;&#20102;&#32500;&#25345;&#31995;&#32479;&#30340;&#26500;&#24314;&#20195;&#30721;&#22359;&#65292;&#25152;&#20197;&#29702;&#35299;&#20182;&#20204;&#30340;&#20301;&#32622;&#26159;&#38750;&#24120;&#37325;&#35201;&#30340;&#65292;&#21363;&#20351;&#20320;&#19981;&#38656;&#35201;&#30452;&#25509;&#36319;&#20182;&#20204;&#25171;&#20132;&#36947;&#12290;</p>


    <div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d4e592"></a>5.2.1.&nbsp;SecurityContextHolder, SecurityContext &#21644; Authentication&#23545;&#35937;</h3></div></div></div>
      
    <p>&#26368;&#22522;&#30784;&#30340;&#23545;&#35937;&#23601;&#26159;<code class="literal">SecurityContextHolder</code>&#12290;
    &#25105;&#20204;&#25226;&#24403;&#21069;&#24212;&#29992;&#31243;&#24207;&#30340;&#24403;&#21069;&#23433;&#20840;&#29615;&#22659;&#30340;&#32454;&#33410;&#23384;&#20648;&#21040;&#23427;&#37324;&#36793;&#20102;&#12290;
    &#40664;&#35748;&#24773;&#20917;&#19979;&#65292;<code class="literal">SecurityContextHolder</code>&#20351;&#29992;<code class="literal">ThreadLocal</code>&#23384;&#20648;&#36825;&#20123;&#20449;&#24687;&#65292;&#36825;&#24847;&#21619;&#30528;&#65292;&#23433;&#20840;&#29615;&#22659;&#22312;&#21516;&#19968;&#20010;&#32447;&#31243;&#25191;&#34892;&#30340;&#26041;&#27861;&#19968;&#30452;&#26159;&#26377;&#25928;&#30340;&#65292;&#21363;&#20351;&#36825;&#20010;&#23433;&#20840;&#29615;&#22659;&#27809;&#26377;&#20316;&#20026;&#19968;&#20010;&#26041;&#27861;&#21442;&#25968;&#20256;&#36882;&#21040;&#37027;&#20123;&#26041;&#27861;&#37324;&#12290;
    &#36825;&#31181;&#24773;&#20917;&#19979;&#20351;&#29992;<code class="literal">ThreadLocal</code>&#26159;&#38750;&#24120;&#23433;&#20840;&#30340;&#65292;&#21482;&#35201;&#35760;&#24471;&#22312;&#22788;&#29702;&#23436;&#24403;&#21069;&#20027;&#20307;&#30340;&#35831;&#27714;&#20197;&#21518;&#65292;&#25226;&#36825;&#20010;&#32447;&#31243;&#28165;&#38500;&#23601;&#34892;&#20102;&#12290;
    &#24403;&#28982;&#65292;Spring Security&#33258;&#21160;&#24110;&#20320;&#31649;&#29702;&#36825;&#19968;&#20999;&#20102;&#65292;&#20320;&#23601;&#19981;&#29992;&#25285;&#24515;&#20160;&#20040;&#20102;&#12290;</p>

    <p>&#26377;&#20123;&#31243;&#24207;&#24182;&#19981;&#36866;&#21512;&#20351;&#29992;<code class="literal">ThreadLocal</code>&#65292;&#22240;&#20026;&#23427;&#20204;&#22788;&#29702;&#32447;&#31243;&#30340;&#29305;&#27530;&#26041;&#27861;&#12290;
    &#27604;&#22914;&#65292;swing&#23458;&#25143;&#31471;&#20063;&#35768;&#24076;&#26395;JVM&#37324;&#30340;usoyou&#32447;&#31243;&#37117;&#20351;&#29992;&#21516;&#19968;&#20010;&#23433;&#20840;&#29615;&#22659;&#12290;
    &#20026;&#20102;&#36825;&#31181;&#24773;&#20917;&#65292;&#25105;&#20204;&#32780;&#24050;&#20351;&#29992;<code class="literal">SecurityContextHolder.MODE_GLOBAL</code>&#12290;
    &#20854;&#20182;&#31243;&#24207;&#21487;&#33021;&#24819;&#35753;&#19968;&#20010;&#32447;&#31243;&#21019;&#24314;&#30340;&#32447;&#31243;&#20063;&#20351;&#29992;&#30456;&#21516;&#30340;&#23433;&#20840;&#20027;&#20307;&#12290;
    &#36825;&#26102;&#21487;&#20197;&#20351;&#29992;<code class="literal">SecurityContextHolder.MODE_INHERITABLETHREADLOCAL</code>&#12290;
    &#24819;&#35201;&#20462;&#25913;&#40664;&#35748;&#30340;<code class="literal">SecurityContextHolder.MODE_THREADLOCAL</code>&#27169;&#24335;&#65292;&#21487;&#20197;&#20351;&#29992;&#20004;&#31181;&#26041;&#27861;&#12290;
    &#31532;&#19968;&#20010;&#26159;&#35774;&#32622;&#31995;&#32479;&#23646;&#24615;&#12290;
    &#21478;&#19968;&#20010;&#26159;&#35843;&#29992;<code class="literal">SecurityContextHolder</code>&#30340;&#38745;&#24577;&#26041;&#27861;&#12290;
    &#22823;&#22810;&#25968;&#31243;&#24207;&#19981;&#38656;&#35201;&#20462;&#25913;&#40664;&#35748;&#20540;&#65292;&#20294;&#26159;&#22914;&#26524;&#20320;&#38656;&#35201;&#20570;&#20462;&#25913;&#65292;&#20808;&#30475;&#19968;&#19979;<code class="literal">SecurityContextHolder</code>&#30340;JavaDoc&#20013;&#30340;&#35814;&#32454;&#20449;&#24687;&#12290;</p>

    <p>&#25105;&#20204;&#25226;&#23433;&#20840;&#20027;&#20307;&#21644;&#31995;&#32479;&#20132;&#20114;&#30340;&#20449;&#24687;&#37117;&#20445;&#23384;&#22312;<code class="literal">SecurityContextHolder</code>&#20013;&#20102;&#12290;
    Spring Security&#20351;&#29992;&#19968;&#20010;<code class="literal">Authentication</code>&#23545;&#24212;&#26469;&#34920;&#29616;&#36825;&#20123;&#20449;&#24687;&#12290;
    &#34429;&#28982;&#20320;&#36890;&#24120;&#19981;&#38656;&#35201;&#33258;&#24049;&#21019;&#24314;&#19968;&#20010;<code class="literal">Authentication</code>&#23545;&#35937;&#65292;&#24456;&#24120;&#35265;&#30340;&#65292;&#29992;&#25143;&#26597;&#35810;<code class="literal">Authentication</code>&#23545;&#35937;&#12290;
    &#20320;&#21487;&#20197;&#20351;&#29992;&#19979;&#38754;&#30340;&#20195;&#30721;-&#22312;&#20320;&#31243;&#24207;&#20013;&#30340;&#20219;&#20309;&#20301;&#32622;-&#26469;&#33719;&#24471;&#24050;&#35748;&#35777;&#29992;&#25143;&#30340;&#21517;&#23383;&#65292;&#27604;&#22914;&#65306;</p>

    <pre class="programlisting">
Object obj = SecurityContextHolder.getContext().getAuthentication().getPrincipal();

if (obj instanceof UserDetails) {
  String username = ((UserDetails)obj).getUsername();
} else {
  String username = obj.toString();
}</pre>

    <p>&#19978;&#38754;&#30340;&#20195;&#30721;&#20171;&#32461;&#20102;&#19968;&#23450;&#25968;&#37327;&#30340;&#65292;&#26377;&#36259;&#30340;&#65292;&#20960;&#20010;&#20851;&#38190;&#23545;&#35937;&#20043;&#38388;&#30340;&#30456;&#20114;&#20851;&#31995;&#12290;
    &#39318;&#20808;&#65292;&#20320;&#20250;&#27880;&#24847;&#21040;<code class="literal">SecurityContextHolder</code> &#21644;
    <code class="literal">Authentication</code>&#20043;&#38388;&#30340;&#20013;&#38388;&#23545;&#35937;&#12290;
    &#36825;&#20010;<code class="literal">SecurityContextHolder.getContext()</code>&#26041;&#27861;&#20250;&#30452;&#25509;&#36820;&#22238;<code class="literal">SecurityContext</code>&#12290;

      
    </p>
    </div>

    <div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d4e617"></a>5.2.2.&nbsp;UserDetailsService</h3></div></div></div>
      

    <p>&#20174;&#19978;&#38754;&#30340;&#20195;&#30721;&#29255;&#27573;&#20013;&#36824;&#21487;&#20197;&#30475;&#20986;&#21478;&#19968;&#20214;&#20107;&#65292;&#23601;&#26159;&#20320;&#21487;&#20197;&#20174;<code class="literal">Authentication</code>&#23545;&#35937;&#20013;&#33719;&#24471;&#23433;&#20840;&#20027;&#20307;&#12290;
    &#36825;&#20010;&#23433;&#20840;&#20027;&#20307;&#23601;&#26159;&#19968;&#20010;&#23545;&#35937;&#12290;
    &#22823;&#22810;&#25968;&#24773;&#20917;&#19979;&#65292;&#21487;&#20197;&#24378;&#21046;&#36716;&#25442;&#25104;<code class="literal">UserDetails</code>&#23545;&#35937;&#12290;
    <code class="literal">UserDetails</code>&#26159;&#19968;&#20010;Spring Security&#30340;&#26680;&#24515;&#25509;&#21475;&#12290;
    &#23427;&#20195;&#34920;&#19968;&#20010;&#20027;&#20307;&#65292;&#26159;&#25193;&#23637;&#30340;&#65292;&#32780;&#19988;&#26159;&#20026;&#29305;&#23450;&#31243;&#24207;&#26381;&#21153;&#30340;&#12290;
    &#24819;&#19968;&#19979;<code class="literal">UserDetails</code>&#31456;&#33410;&#65292;&#22312;&#20320;&#33258;&#24049;&#30340;&#29992;&#25143;&#25968;&#25454;&#24211;&#21644;&#22914;&#20309;&#25226;Spring Security&#38656;&#35201;&#30340;&#25968;&#25454;&#25918;&#21040;<code class="literal">SecurityContextHolder</code>&#37324;&#12290;
    &#20026;&#20102;&#35753;&#20320;&#33258;&#24049;&#30340;&#29992;&#25143;&#25968;&#25454;&#24211;&#36215;&#20316;&#29992;&#65292;&#25105;&#20204;&#24120;&#24120;&#25226;<code class="literal">UserDetails</code>&#36716;&#25442;&#25104;&#20320;&#31995;&#32479;&#25552;&#20379;&#30340;&#31867;&#65292;&#36825;&#26679;&#20320;&#23601;&#21487;&#20197;&#30452;&#25509;&#35843;&#29992;&#19994;&#21153;&#30456;&#20851;&#30340;&#26041;&#27861;&#20102;&#65288;&#27604;&#22914;<code class="literal">getEmail()</code>, <code class="literal">getEmployeeNumber()</code>&#31561;&#31561;&#65289;&#12290;</p>

    <p>&#29616;&#22312;&#65292;&#20320;&#21487;&#33021;&#24819;&#30693;&#36947;&#65292;&#25105;&#24212;&#35813;&#20160;&#20040;&#26102;&#20505;&#25552;&#20379;&#36825;&#20010;<code class="literal">UserDetails</code>&#23545;&#35937;&#21602;&#65311;
    &#25105;&#24590;&#20040;&#20570;&#21602;&#65311;
    &#25105;&#24819;&#20320;&#35828;&#36825;&#20010;&#19996;&#35199;&#26159;&#22768;&#26126;&#24335;&#30340;&#65292;&#25105;&#19981;&#38656;&#35201;&#20889;&#20219;&#20309;&#20195;&#30721;&#65292;&#24590;&#20040;&#21150;&#65311;
    &#31616;&#21333;&#30340;&#22238;&#31572;&#26159;&#65292;&#36825;&#37324;&#26377;&#19968;&#20010;&#29305;&#27530;&#30340;&#25509;&#21475;&#65292;&#21483;<code class="literal">UserDetailsService</code>&#12290;
    &#36825;&#20010;&#25509;&#21475;&#37324;&#30340;&#21807;&#19968;&#19968;&#20010;&#26041;&#27861;&#65292;&#25509;&#25910;<code class="literal">String</code>&#31867;&#22411;&#30340;&#29992;&#25143;&#21517;&#21442;&#25968;&#65292;&#36820;&#22238;<code class="literal">UserDetails</code>&#12290;
    &#22823;&#22810;&#25968;&#39564;&#35777;&#25552;&#20379;&#22120;&#20351;&#29992;Spring Security&#20195;&#29702;<code class="literal">UserDetailsService</code>&#65292;&#20316;&#20026;&#39564;&#35777;&#36807;&#31243;&#30340;&#19968;&#37096;&#20998;&#12290;
    &#36825;&#20010;<code class="literal">UserDetailsService</code>&#29992;&#26469;&#24314;&#31435;<code class="literal">Authentication</code>&#23545;&#35937;&#65292;&#20445;&#23384;&#22312;<code class="literal">SecurityContextHolder</code>&#37324;&#12290;
    &#22909;&#28040;&#24687;&#26159;&#25105;&#20204;&#25552;&#20379;&#20102;&#22909;&#20960;&#20010;<code class="literal">UserDetailsService</code>&#23454;&#29616;&#65292;&#20854;&#20013;&#19968;&#20010;&#20351;&#29992;&#20869;&#23384;&#37324;&#30340;map&#65292;&#21478;&#19968;&#20010;&#20351;&#29992;JDBC&#12290;
    &#34429;&#28982;&#65292;&#22823;&#22810;&#25968;&#29992;&#25143;&#20542;&#21521;&#20110;&#20889;&#33258;&#24049;&#30340;&#65292;&#20351;&#29992;&#36825;&#20123;&#23454;&#29616;&#24120;&#24120;&#25918;&#21040;&#24050;&#26377;&#30340;&#25968;&#25454;&#35775;&#38382;&#23545;&#35937;&#65288;DAO&#65289;&#19978;&#65292;&#34920;&#31034;&#23427;&#20204;&#30340;&#38599;&#21592;&#65292;&#23458;&#25143;&#25110;&#20854;&#20182;&#20225;&#19994;&#24212;&#29992;&#20013;&#30340;&#29992;&#25143;&#12290;
    &#35760;&#20303;&#36825;&#20010;&#20248;&#21183;&#65292;&#26080;&#35770;&#20320;&#29992;&#20160;&#20040;UserDetailsService&#36820;&#22238;&#30340;&#25968;&#25454;&#37117;&#21487;&#20197;&#36890;&#36807;<code class="literal">SecurityContextHolder</code>&#33719;&#24471;&#65292;&#23601;&#20687;&#19978;&#38754;&#30340;&#20195;&#30721;&#29255;&#27573;&#35762;&#30340;&#19968;&#26679;&#12290;</p>
    </div>


    <div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="tech-granted-authority"></a>5.2.3.&nbsp;GrantedAuthority</h3></div></div></div>
      

    <p>&#38500;&#20102;&#20027;&#20307;&#65292;&#21478;&#19968;&#20010;<code class="literal">Authentication</code>&#25552;&#20379;&#30340;&#37325;&#35201;&#26041;&#27861;&#26159;<code class="literal">getAuthorities(</code>)&#12290;
    &#36825;&#20010;&#26041;&#27861;&#25552;&#20379;&#20102;<code class="literal">GrantedAuthority</code>&#23545;&#35937;&#25968;&#32452;&#12290;
    &#27627;&#26080;&#30097;&#38382;&#65292;<code class="literal">GrantedAuthority</code>&#26159;&#36171;&#20104;&#21040;&#20027;&#20307;&#30340;&#26435;&#38480;&#12290;
    &#36825;&#20123;&#26435;&#38480;&#36890;&#24120;&#20351;&#29992;&#35282;&#33394;&#34920;&#31034;&#65292;&#27604;&#22914;<code class="literal">ROLE_ADMINISTRATOR</code> &#25110;
    <code class="literal">ROLE_HR_SUPERVISOR</code>&#12290;
    &#36825;&#20123;&#35282;&#33394;&#20250;&#22312;&#21518;&#38754;&#65292;&#23545;web&#39564;&#35777;&#65292;&#26041;&#27861;&#39564;&#35777;&#21644;&#39046;&#22495;&#23545;&#35937;&#39564;&#35777;&#36827;&#34892;&#37197;&#32622;&#12290;
    Spring Security&#30340;&#20854;&#20182;&#37096;&#20998;&#29992;&#26469;&#25318;&#25130;&#36825;&#20123;&#26435;&#38480;&#65292;&#26399;&#26395;&#20182;&#20204;&#34987;&#34920;&#29616;&#20986;&#29616;&#12290;
    <code class="literal">GrantedAuthority</code>&#23545;&#35937;&#36890;&#24120;&#20351;&#29992;<code class="literal">UserDetailsService</code>&#35835;&#21462;&#30340;&#12290;
    </p>

    <p>&#36890;&#24120;&#24773;&#20917;&#19979;&#65292;<code class="literal">GrantedAuthority</code>&#23545;&#35937;&#26159;&#24212;&#29992;&#31243;&#24207;&#33539;&#22260;&#19979;&#30340;&#25480;&#26435;&#12290;
    &#23427;&#20204;&#19981;&#20250;&#29305;&#24847;&#20998;&#37197;&#32473;&#19968;&#20010;&#29305;&#23450;&#30340;&#39046;&#22495;&#23545;&#35937;&#12290;
    &#22240;&#27492;&#65292;&#20320;&#19981;&#33021;&#35774;&#32622;&#19968;&#20010;<code class="literal">GrantedAuthority</code>&#65292;&#35753;&#23427;&#26377;&#26435;&#38480;&#23637;&#31034;&#32534;&#21495;54&#30340;<code class="literal">Employee</code>&#23545;&#35937;&#65292;&#22240;&#20026;&#22914;&#26524;&#26377;&#25104;&#21315;&#19978;&#32593;&#30340;&#36825;&#31181;&#25480;&#26435;&#65292;&#20320;&#20250;&#24456;&#24555;&#29992;&#20809;&#20869;&#23384;&#65288;&#25110;&#32773;&#65292;&#33267;&#23569;&#65292;&#23548;&#33268;&#31243;&#24207;&#33457;&#36153;&#22823;&#37327;&#26102;&#38388;&#21435;&#39564;&#35777;&#19968;&#20010;&#29992;&#25143;&#65289;&#12290;
    &#24403;&#28982;&#65292;Spring Security&#34987;&#26126;&#30830;&#35774;&#35745;&#25104;&#22788;&#29702;&#24120;&#35265;&#30340;&#38656;&#27714;&#65292;&#20294;&#26159;&#20320;&#26368;&#22909;&#21035;&#22240;&#20026;&#36825;&#20010;&#30446;&#30340;&#20351;&#29992;&#39033;&#30446;&#39046;&#22495;&#27169;&#22411;&#23433;&#20840;&#21151;&#33021;&#12290;</p>

    <p>&#26368;&#21518;&#65292;&#20294;&#19981;&#26159;&#26368;&#19981;&#37325;&#35201;&#30340;&#65292;&#20248;&#21183;&#20320;&#38656;&#35201;&#22312;HTTP&#35831;&#27714;&#20043;&#38388;&#20849;&#20139;<code class="literal">SecurityContext</code>.
    &#20854;&#20182;&#26102;&#20505;&#65292;&#20027;&#20307;&#20250;&#22312;&#27599;&#20010;&#35831;&#27714;&#37324;&#37325;&#26032;&#39564;&#35777;&#65292;&#34429;&#28982;&#22823;&#22810;&#25968;&#24773;&#20917;&#19979;&#23427;&#21487;&#20197;&#23384;&#20648;&#12290;
    <code class="literal">HttpSessionContextIntegrationFilter</code>&#23601;&#26159;&#23454;&#29616;&#22312;HTTP&#35831;&#27714;&#20043;&#38388;&#23384;&#20648;<code class="literal">SecurityContext</code>&#30340;&#12290;
    &#23601;&#20687;&#23427;&#30340;&#31867;&#21517;&#19968;&#26679;&#65292;<code class="literal">HttpSession</code>&#34987;&#29992;&#26469;&#20445;&#23384;&#36825;&#20123;&#20449;&#24687;&#12290;
    &#20320;&#19981;&#24212;&#35813;&#22240;&#20026;&#23433;&#20840;&#30340;&#38382;&#39064;&#65292;&#30452;&#25509;&#19982;<code class="literal">HttpSession</code>&#25171;&#20132;&#36947;&#12290;
    &#26681;&#26412;&#19981;&#23384;&#22312;&#36825;&#26679;&#20570;&#30340;&#29702;&#30001;-&#19968;&#30452;&#20351;&#29992;<code class="literal">SecurityContextHolder</code>&#20316;&#26367;&#20195;&#26041;&#24335;&#12290;</p>

    </div>


    <div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d4e661"></a>5.2.4.&nbsp;&#23567;&#32467;</h3></div></div></div>
      
    <p>&#31616;&#21333;&#22238;&#39038;&#19968;&#19979;&#65292;Spring Security&#20027;&#35201;&#26159;&#30001;&#19968;&#19979;&#20960;&#37096;&#20998;&#32452;&#25104;&#30340;&#65306;</p>

    <div class="itemizedlist"><ul type="disc" compact><li>
        <p><code class="literal">SecurityContextHolder</code>&#65292;&#25552;&#20379;&#20960;&#31181;&#35775;&#38382;<code class="literal">SecurityContext</code>&#30340;&#26041;&#24335;&#12290;</p>
      </li><li>
        <p><code class="literal">SecurityContext</code>&#65292;&#20445;&#23384;<code class="literal">Authentication</code>&#20449;&#24687;&#65292;&#21644;&#35831;&#27714;&#23545;&#24212;&#30340;&#23433;&#20840;&#20449;&#24687;&#12290;</p>
      </li><li>
        <p><code class="literal">HttpSessionContextIntegrationFilter</code>&#65292;&#20026;&#20102;&#22312;&#19981;&#21516;&#35831;&#27714;&#20351;&#29992;&#65292;&#25226;<code class="literal">SecurityContext</code>&#20445;&#23384;&#21040;
        <code class="literal">HttpSession</code>&#37324;&#12290;</p>
      </li><li>
        <p><code class="literal">Authentication</code>&#65292;&#23637;&#31034;Spring Security&#29305;&#23450;&#30340;&#20027;&#20307;&#12290;</p>
      </li><li>
        <p><code class="literal">GrantedAuthority</code>&#65292;&#21453;&#24212;&#65292;&#22312;&#24212;&#29992;&#31243;&#24207;&#33539;&#22260;&#20320;&#65292;&#36171;&#20104;&#20027;&#20307;&#30340;&#26435;&#38480;&#12290;</p>
      </li><li>
        <p><code class="literal">UserDetails</code>&#65292;&#36890;&#36807;&#20320;&#30340;&#24212;&#29992;DAO&#65292;&#25552;&#20379;&#24517;&#35201;&#30340;&#20449;&#24687;&#65292;&#26500;&#24314;Authentication&#23545;&#35937;&#12290;</p>
      </li><li>
        <p><code class="literal">UserDetailsService</code>&#65292;&#21019;&#24314;&#19968;&#20010;
        <code class="literal">UserDetails</code>&#65292;&#20256;&#36882;&#19968;&#20010;
        <code class="literal">String</code>&#31867;&#22411;&#30340;&#29992;&#25143;&#21517;&#65288;&#25110;&#32773;&#35777;&#20070;ID&#25110;&#20854;&#20182;&#65289;&#12290;</p>
      </li></ul></div>

    <p>&#29616;&#22312;&#65292;&#20320;&#24212;&#35813;&#23545;&#36825;&#31181;&#37325;&#22797;&#20351;&#29992;&#30340;&#32452;&#20214;&#26377;&#19968;&#20123;&#20102;&#35299;&#20102;&#12290;
    &#35753;&#25105;&#20204;&#36148;&#36817;&#30475;&#19968;&#19979;&#39564;&#35777;&#30340;&#36807;&#31243;&#12290;</p>
      </div>
  </div>

  <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="common-authentication"></a>5.3.&nbsp;&#39564;&#35777;</h2></div></div></div>
    

    <p>&#23601;&#20687;&#36825;&#31687;&#25351;&#21335;&#24320;&#22836;&#25552;&#21040;&#30340;&#37027;&#26679;&#65292;Spring Security&#21487;&#22312;&#24456;&#22810;&#19981;&#21516;&#30340;&#39564;&#35777;&#29615;&#22659;&#19979;&#20351;&#29992;&#12290;
    &#34429;&#28982;&#25105;&#20204;&#25512;&#33616;&#20154;&#20204;&#20351;&#29992;Spring Security&#65292;&#19981;&#19982;&#24050;&#23384;&#22312;&#30340;&#23481;&#22120;&#31649;&#29702;&#35748;&#35777;&#31995;&#32479;&#25972;&#21512;&#65292;&#20294;&#23427;&#20063;&#26159;&#25903;&#25345;&#30340;-&#20351;&#29992;&#20320;&#33258;&#24049;&#30340;&#23646;&#24615;&#39564;&#35777;&#31995;&#32479;&#36827;&#34892;&#25972;&#21512;&#12290;
    &#35753;&#25105;&#20204;&#20808;&#30475;&#30475;Spring Security&#23436;&#20840;&#20381;&#38752;&#33258;&#24049;&#65292;&#31649;&#29702;web&#23433;&#20840;&#65292;&#36825;&#37324;&#20250;&#28436;&#31034;&#26368;&#22797;&#26434;&#21644;&#26368;&#24120;&#35265;&#30340;&#24773;&#20917;&#12290;</p>

    <p>&#35752;&#35770;&#19968;&#20010;&#20856;&#22411;&#30340;web&#24212;&#29992;&#39564;&#35777;&#36807;&#31243;&#65306;</p>

    <div class="orderedlist"><ol type="1"><li>
        <p>&#20320;&#35775;&#38382;&#39318;&#39029;&#65292;&#28857;&#20987;&#19968;&#20010;&#38142;&#25509;&#12290;</p>
      </li><li>
        <p>&#21521;&#26381;&#21153;&#22120;&#21457;&#36865;&#19968;&#20010;&#35831;&#27714;&#65292;&#26381;&#21153;&#22120;&#21028;&#26029;&#20320;&#26159;&#21542;&#22312;&#35775;&#38382;&#19968;&#20010;&#21463;&#20445;&#25252;&#30340;&#36164;&#28304;&#12290;</p>
      </li><li>
        <p>&#22914;&#26524;&#20320;&#36824;&#27809;&#26377;&#36827;&#34892;&#36807;&#35748;&#35777;&#65292;&#26381;&#21153;&#22120;&#21457;&#22238;&#19968;&#20010;&#21709;&#24212;&#65292;&#25552;&#31034;&#20320;&#24517;&#39035;&#36827;&#34892;&#35748;&#35777;&#12290;
        &#21709;&#24212;&#21487;&#33021;&#26159;HTTP&#21709;&#24212;&#20195;&#30721;&#65292;&#25110;&#32773;&#26159;&#37325;&#26032;&#23450;&#21521;&#21040;&#19968;&#20010;&#29305;&#23450;&#30340;web&#39029;&#38754;&#12290;</p>
      </li><li>
        <p>&#20381;&#25454;&#39564;&#35777;&#26426;&#21046;&#65292;&#20320;&#30340;&#27983;&#35272;&#22120;&#23558;&#37325;&#23450;&#21521;&#21040;&#29305;&#23450;&#30340;web&#39029;&#38754;&#65292;&#36825;&#26679;&#20320;&#21487;&#20197;&#28155;&#21152;&#34920;&#21333;&#65292;
        &#25110;&#32773;&#27983;&#35272;&#22120;&#20351;&#29992;&#20854;&#20182;&#26041;&#24335;&#26657;&#39564;&#20320;&#30340;&#36523;&#20221;&#65288;&#27604;&#22914;&#65292;&#19968;&#20010;&#22522;&#26412;&#26657;&#39564;&#23545;&#35805;&#26694;&#65292;cookie&#65292;&#25110;&#32773;X509&#35777;&#20070;&#65292;&#25110;&#32773;&#20854;&#20182;&#65289;&#12290;</p>
      </li><li>
        <p>&#27983;&#35272;&#22120;&#20250;&#21457;&#22238;&#19968;&#20010;&#21709;&#24212;&#32473;&#26381;&#21153;&#22120;&#12290;
        &#36825;&#23558;&#26159;HTTP POST&#21253;&#21547;&#20320;&#22635;&#20889;&#30340;&#34920;&#21333;&#20869;&#23481;&#65292;&#25110;&#32773;&#26159;HTTP&#22836;&#37096;&#65292;&#21253;&#21547;&#20320;&#30340;&#39564;&#35777;&#20449;&#24687;&#12290;</p>
      </li><li>
        <p>&#19979;&#19968;&#27493;&#65292;&#26381;&#21153;&#22120;&#20250;&#21028;&#26029;&#24403;&#21069;&#30340;&#35777;&#20070;&#26159;&#21542;&#26159;&#26377;&#25928;&#30340;&#65292;
        &#22914;&#26524;&#20182;&#20204;&#26159;&#26377;&#25928;&#30340;&#65292;&#19979;&#19968;&#27493;&#20250;&#25191;&#34892;&#12290;
        &#22914;&#26524;&#20182;&#20204;&#26159;&#38750;&#27861;&#30340;&#65292;&#36890;&#24120;&#20320;&#30340;&#27983;&#35272;&#22120;&#20250;&#20877;&#23581;&#35797;&#19968;&#27425;&#65288;&#25152;&#20197;&#20320;&#36820;&#22238;&#30340;&#27493;&#39588;&#20108;&#65289;&#12290;</p>
      </li><li>
        <p>&#20320;&#21457;&#36865;&#30340;&#21407;&#22987;&#35831;&#27714;&#65292;&#20250;&#23548;&#33268;&#37325;&#26032;&#23581;&#35797;&#39564;&#35777;&#36807;&#31243;&#12290;
        &#26377;&#24076;&#26395;&#30340;&#26159;&#65292;&#20320;&#20250;&#36890;&#36807;&#39564;&#35777;&#65292;&#24471;&#21040;&#29482;&#29399;&#30340;&#25480;&#26435;&#65292;&#35775;&#38382;&#34987;&#20445;&#25252;&#30340;&#36164;&#28304;&#12290;
        &#22914;&#26524;&#20320;&#26377;&#36275;&#22815;&#30340;&#26435;&#38480;&#65292;&#35831;&#27714;&#20250;&#25104;&#21151;&#12290;&#21542;&#21017;&#65292;&#20320;&#20250;&#25910;&#21040;&#19968;&#20010;HTTP&#38169;&#35823;&#20195;&#30721;403&#65292;&#24847;&#24605;&#26159;&#35775;&#38382;&#34987;&#25298;&#32477;&#12290;</p>
      </li></ol></div>

    <p>Spring Security&#20351;&#29992;&#40092;&#26126;&#30340;&#31867;&#36127;&#36131;&#19978;&#38754;&#25552;&#21040;&#30340;&#27599;&#20010;&#27493;&#39588;&#12290;
    &#20027;&#35201;&#30340;&#37096;&#20998;&#26159;&#65288;&#20026;&#20102;&#20351;&#29992;&#20182;&#20204;&#65289;&#26159;<code class="literal">ExceptionTranslationFilter</code>&#65292;
    &#19968;&#20010;<code class="literal">AuthenticationEntryPoint</code>,
    &#19968;&#20010;&#39564;&#35777;&#26426;&#21046;&#65292;&#19968;&#20010;<code class="literal">AuthenticationProvider</code>&#12290;</p>

    <div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d4e718"></a>5.3.1.&nbsp;ExceptionTranslationFilter</h3></div></div></div>
      
      <p><code class="literal">ExceptionTranslationFilter</code>&#26159;&#19968;&#20010;Spring
        Security&#36807;&#28388;&#22120;&#65292;&#29992;&#26469;&#26816;&#27979;&#26159;&#21542;&#25243;&#20986;&#20102;Spring Security&#24322;&#24120;&#12290;
        &#36825;&#20123;&#24322;&#24120;&#20250;&#34987;<code class="literal">AbstractSecurityInterceptor</code>&#25243;&#20986;&#65292;&#23427;&#20027;&#35201;&#29992;&#26469;&#25552;&#20379;&#39564;&#35777;&#26381;&#21153;&#12290;
        &#25105;&#20204;&#20250;&#22312;&#19979;&#19968;&#33410;&#35752;&#35770;<code class="literal">AbstractSecurityInterceptor</code>&#65292;&#20294;&#26159;&#29616;&#22312;&#65292;&#25105;&#20204;&#21482;&#38656;&#35201;&#30693;&#36947;&#65292;&#23427;&#26159;&#29992;&#26469;&#29983;&#25104;Java&#24322;&#24120;&#65292;&#21644;&#30693;&#36947;&#36319;HTTP&#27809;&#21861;&#20851;&#31995;&#65292;&#25110;&#32773;&#22914;&#20309;&#39564;&#35777;&#19968;&#20010;&#20027;&#20307;&#12290;
        &#32780;<code class="literal">ExceptionTranslationFilter</code>&#25552;&#20379;&#36825;&#20123;&#26381;&#21153;&#65292;&#20351;&#29992;&#29305;&#28857;&#37027;&#20010;&#30340;&#21709;&#24212;&#65292;&#36820;&#22238;&#38169;&#35823;&#20195;&#30721;403&#65288;&#22914;&#26524;&#20027;&#39064;&#34987;&#39564;&#35777;&#20102;&#65292;&#20294;&#26159;&#26435;&#38480;&#19981;&#36275;-&#22312;&#19978;&#36793;&#30340;&#27493;&#39588;&#19971;&#65289;&#65292;&#25110;&#32773;&#21551;&#21160;&#19968;&#20010;<code class="literal">AuthenticationEntryPoint</code>&#65288;&#22914;&#26524;&#20027;&#20307;&#27809;&#26377;&#35748;&#35777;&#65292;&#28982;&#21518;&#25105;&#20204;&#38656;&#35201;&#36827;&#20837;&#27493;&#39588;&#19977;&#65289;&#12290;</p>
    </div>

    <div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="tech-auth-entry-point"></a>5.3.2.&nbsp;AuthenticationEntryPoint</h3></div></div></div>
      
    <p><code class="literal">AuthenticationEntryPoint</code>&#23545;&#24212;&#20013;&#19978;&#38754;&#21015;&#34920;&#20013;&#30340;&#27493;&#39588;&#19977;&#12290;
    &#22914;&#20320;&#25152;&#24819;&#30340;&#65292;&#27599;&#20010;web&#24212;&#29992;&#31243;&#24207;&#37117;&#26377;&#40664;&#35748;&#30340;&#39564;&#35777;&#31574;&#30053;&#65288;&#22909;&#30340;&#65292;&#36825;&#21487;&#20197;&#22312;Spring Security&#37324;&#37197;&#32622;&#19968;&#20999;&#65292;&#20294;&#26159;&#35753;&#25105;&#20204;&#29616;&#22312;&#20445;&#25345;&#31616;&#21333;&#65289;&#12290;
    &#27599;&#20010;&#20027;&#35201;&#39564;&#35777;&#31995;&#32479;&#20250;&#26377;&#23427;&#33258;&#24049;&#30340;<code class="literal">AuthenticationEntryPoint</code>&#23454;&#29616;&#65292;
    &#20250;&#25191;&#34892;&#21160;&#20316;&#65292;&#22914;&#21516;&#27493;&#39588;&#19977;&#37324;&#30340;&#25551;&#36848;&#19968;&#26679;&#12290;</p>

    <p>&#22312;&#20320;&#30340;&#27983;&#35272;&#22120;&#20915;&#23450;&#25552;&#20132;&#20320;&#30340;&#35748;&#35777;&#35777;&#20070;&#20043;&#21518;&#65288;&#20351;&#29992;HTTP&#34920;&#21333;&#21457;&#36865;&#25110;&#32773;&#26159;HTTP&#22836;&#65289;&#65292;&#26381;&#21153;&#22120;&#37096;&#20998;&#38656;&#35201;&#26377;&#19968;&#20123;&#19996;&#35199;&#26469;&#8220;&#25910;&#38598;&#8221;&#36825;&#20123;&#39564;&#35777;&#20449;&#24687;&#12290;
    &#29616;&#22312;&#25105;&#20204;&#21040;&#20102;&#19978;&#36848;&#30340;&#31532;&#20845;&#27493;&#12290;
    &#22312;Spring Security&#37324;&#65292;&#25105;&#20204;&#38656;&#35201;&#19968;&#20010;&#29305;&#23450;&#30340;&#21517;&#23383;&#65292;&#26469;&#25551;&#36848;&#20174;&#29992;&#25143;&#20195;&#30721;&#65288;&#36890;&#24120;&#26159;&#27983;&#35272;&#22120;&#65289;&#25910;&#38598;&#39564;&#35777;&#20449;&#24687;&#30340;&#21151;&#33021;&#65292;&#36825;&#20010;&#21517;&#23383;&#23601;&#26159;&#8220;&#39564;&#35777;&#26426;&#21046;&#8221;&#12290;
    &#22312;&#20174;&#29992;&#25143;&#20195;&#30721;&#21738;&#37324;&#25910;&#38598;&#20102;&#39564;&#35777;&#32454;&#33410;&#20043;&#21518;&#65292;&#19968;&#20010;"<code class="literal">Authentication</code> &#35831;&#27714;"&#23545;&#35937;&#20250;&#34987;<code class="interfacename">AuthenticationProvider</code>&#24314;&#31435;&#12290;</p>
    </div>

    <div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d4e734"></a>5.3.3.&nbsp;AuthenticationProvider</h3></div></div></div>
    <p>Spring Security&#35748;&#35777;&#36807;&#31243;&#30340;&#26368;&#21518;&#19968;&#20010;&#35282;&#33394;&#26159;<code class="literal">AuthenticationProvider</code>&#12290;
    &#38750;&#24120;&#31616;&#21333;&#65292;&#36825;&#26159;&#36319;&#33719;&#24471;<code class="literal">Authentication</code>&#35831;&#27714;&#23545;&#35937;&#30456;&#20851;&#30340;&#65292;&#20915;&#23450;&#23427;&#26159;&#21542;&#26159;&#26377;&#25928;&#30340;&#12290;
    &#36825;&#20010;&#20379;&#24212;&#22120;&#25110;&#32773;&#25243;&#20986;&#19968;&#20010;&#24322;&#24120;&#65292;&#25110;&#32773;&#36820;&#22238;&#19968;&#20010;&#23436;&#25972;&#30340;<code class="literal">Authentication</code>&#23545;&#35937;&#12290;
    &#36824;&#35760;&#24471;&#25105;&#20204;&#30340;&#22909;&#26379;&#21451;<code class="literal">UserDetails</code>&#21644;<code class="literal">UserDetailsService</code>&#21527;&#65311;
    &#22914;&#26524;&#19981;&#35760;&#24471;&#65292;&#22238;&#22836;&#30475;&#30475;&#21069;&#38754;&#30340;&#31456;&#33410;&#65292;&#21047;&#26032;&#20320;&#30340;&#35760;&#24518;&#12290;
    &#22823;&#22810;&#25968;<code class="literal">AuthenticationProvider</code>&#37117;&#20250;&#35201;&#27714;<code class="literal">UserDetailsService</code>&#25552;&#20379;&#19968;&#20010;<code class="literal">UserDetails</code>&#23545;&#35937;&#12290;
    &#20687;&#19978;&#38754;&#25552;&#21040;&#30340;&#37027;&#26679;&#65292;&#22823;&#22810;&#25968;&#31243;&#24207;&#20250;&#25552;&#20379;&#20182;&#20204;&#33258;&#24049;&#30340;<code class="literal">UserDetailsService</code>&#34429;&#28982;&#19968;&#20123;&#21487;&#20197;&#20351;&#29992;Spring Security&#25552;&#20379;&#30340;JDBC&#21644;&#20869;&#23384;&#23454;&#29616;&#12290;
    &#30001;&#27492;&#20135;&#29983;&#30340;<code class="literal">UserDetails</code>&#23545;&#35937;-&#29305;&#21035;&#26159;<code class="literal">UserDetails</code>&#20013;&#21253;&#21547;&#30340;<code class="literal">GrantedAuthority[]</code>-&#23558;&#34987;&#29992;&#26469;&#32452;&#35013;<code class="literal">Authentication</code>&#23545;&#35937;&#12290;</p>
    <p>&#22312;&#39564;&#35777;&#26426;&#21046;&#37325;&#26032;&#33719;&#24471;&#20102;&#32452;&#35013;&#22909;&#30340;<code class="literal">Authentication</code>&#23545;&#35937;&#20197;&#21518;&#65292;&#20182;&#20250;&#35748;&#20026;&#35831;&#27714;&#26377;&#25928;&#65292;&#25226;<code class="literal">Authentication</code>&#25918;&#21040;<code class="literal">SecurityContextHolder</code>&#37324;&#65292;&#28982;&#21518;&#23548;&#33268;&#21407;&#22987;&#35831;&#27714;&#37325;&#23457;&#65288;&#31532;&#19971;&#27493;&#65289;&#12290;
    &#21478;&#19968;&#26041;&#38754;&#65292;&#22914;&#26524;<code class="literal">AuthenticationProvider</code>&#39539;&#22238;&#20102;&#35831;&#27714;&#65292;&#39564;&#35777;&#26426;&#21046;&#20250;&#35753;&#29992;&#25143;&#20195;&#30721;&#37325;&#35797;&#65288;&#31532;&#20108;&#27493;&#65289;&#12290;</p>

    </div>

    <div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d4e755"></a>5.3.4.&nbsp;&#30452;&#25509;&#35774;&#32622;SecurityContextHolder&#30340;&#20869;&#23481;</h3></div></div></div>
      
      <p>&#34429;&#28982;&#36825;&#34920;&#36848;&#20102;&#19968;&#20010;&#20856;&#22411;&#30340;&#39564;&#35777;&#27969;&#31243;&#65292;&#20294;&#26159;&#22909;&#28040;&#24687;&#26159;Spring Security&#19981;&#22312;&#24847;&#20320;&#22914;&#20309;&#25226;&#19968;&#20010;<code class="literal">Authentication</code>&#25918;&#21040;<code class="literal">SecurityContextHolder</code>&#37324;&#30340;&#12290;
      &#21807;&#19968;&#20851;&#38190;&#30340;&#38656;&#27714;&#26159;<code class="literal">SecurityContextHolder</code>&#21253;&#21547;<code class="literal">Authentication</code>&#65292;&#29992;&#26469;&#34920;&#29616;&#19968;&#20010;&#20027;&#20307;&#65292;&#22312;<code class="literal">AbstractSecurityInterceptor</code>&#20043;&#21069;&#39564;&#35777;&#35831;&#27714;&#30340;&#12290;</p>

      <p>&#20320;&#21487;&#20197;&#65288;&#24456;&#22810;&#29992;&#25143;&#37117;&#36825;&#26679;&#20570;&#65289;&#20889;&#19968;&#20010;&#33258;&#24049;&#30340;&#36807;&#28388;&#22120;&#25110;MVC&#25511;&#21046;&#22120;&#26469;&#25552;&#20379;&#39564;&#35777;&#31995;&#32479;&#30340;&#20132;&#20114;&#65292;&#36825;&#20123;&#37117;&#19981;&#26159;&#22522;&#20110;Spring Security&#30340;&#12290;
      &#27604;&#22914;&#65292;&#20320;&#20063;&#35768;&#20351;&#29992;&#23481;&#22120;&#31649;&#29702;&#39564;&#35777;&#65292;&#20174;ThreadLocal&#25110;JNDI&#37324;&#33719;&#24471;&#24403;&#21069;&#29992;&#25143;&#20449;&#24687;&#12290;
      &#25110;&#32773;&#65292;&#20320;&#30340;&#20844;&#21496;&#21487;&#33021;&#26377;&#19968;&#20010;&#36951;&#30041;&#31995;&#32479;&#65292;&#23427;&#26159;&#19968;&#20010;&#20225;&#19994;&#26631;&#20934;&#65292;&#20320;&#19981;&#33021;&#25511;&#21046;&#23427;&#12290;
      &#36825;&#31181;&#24773;&#20917;&#19979;&#65292;&#24456;&#23481;&#26131;&#35753;Spring Security&#24037;&#20316;&#65292;&#20063;&#33021;&#25552;&#20379;&#39564;&#35777;&#33021;&#21147;&#12290;
      &#20320;&#25152;&#38656;&#35201;&#30340;&#23601;&#26159;&#20889;&#19968;&#20010;&#36807;&#28388;&#22120;&#65288;&#25110;&#31561;&#20215;&#29289;&#65289;&#20174;&#25351;&#23450;&#20301;&#32622;&#35835;&#21462;&#31532;&#19977;&#26041;&#29992;&#25143;&#20449;&#24687;&#65292;&#25226;&#23427;&#25918;&#21040;SecurityContextHolder&#37324;&#12290;
      &#23454;&#29616;&#36825;&#20123;&#24456;&#31616;&#21333;&#65292;&#36825;&#31181;&#25972;&#21512;&#26159;&#23436;&#20840;&#34987;&#25903;&#25345;&#30340;&#26041;&#27861;&#12290;</p>
    </div>
  </div>

  <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="secure-objects"></a>5.4.&nbsp;&#23433;&#20840;&#23545;&#35937;</h2></div></div></div>
    

    <p>Spring Security&#20351;&#29992;&#35789;&#32452;"secure object"&#26469;&#25351;&#20195;&#20219;&#20309;&#38656;&#35201;&#20445;&#25252;&#30340;&#23545;&#35937;&#65288;&#23601;&#20687;&#19968;&#20010;&#35748;&#35777;&#20915;&#23450;&#65289;&#12290;
    &#26368;&#24120;&#35265;&#20363;&#23376;&#23601;&#26159;&#26041;&#27861;&#35843;&#29992;&#21644;web&#35831;&#27714;&#12290;
    </p>

    <div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d4e769"></a>5.4.1.&nbsp;&#23433;&#20840;&#21644;AOP&#24314;&#35758;</h3></div></div></div>
      
      <p>&#22914;&#26524;&#20320;&#29087;&#24713;AOP&#30340;&#35805;&#65292;&#23601;&#20250;&#30693;&#36947;&#26377;&#20960;&#31181;&#19981;&#21516;&#30340;&#25318;&#25130;&#26041;&#24335;&#65306;&#20043;&#21069;&#65292;&#20043;&#21518;&#65292;&#25243;&#24322;&#24120;&#21644;&#29615;&#32469;&#12290;
      &#20854;&#20013;&#29615;&#32469;&#26159;&#38750;&#24120;&#26377;&#29992;&#30340;&#65292;&#22240;&#20026;advisor&#21487;&#20197;&#20915;&#23450;&#26159;&#21542;&#25191;&#34892;&#36825;&#20010;&#26041;&#27861;&#65292;&#26159;&#21542;&#20462;&#25913;&#36820;&#22238;&#30340;&#32467;&#26524;&#65292;&#26159;&#21542;&#25243;&#20986;&#24322;&#24120;&#12290;
      Spring Security&#20026;&#26041;&#27861;&#35843;&#29992;&#25552;&#20379;&#20102;&#19968;&#20010;&#29615;&#32469;advice&#65292;&#23601;&#20687;web&#35831;&#27714;&#19968;&#26679;&#12290;
      &#25105;&#20204;&#20351;&#29992;Spring&#30340;&#26631;&#20934;AOP&#25903;&#25345;&#21046;&#20316;&#20102;&#19968;&#20010;&#22788;&#29702;&#26041;&#27861;&#35843;&#29992;&#30340;&#29615;&#32469;advice&#65292;&#25105;&#20204;&#20351;&#29992;&#26631;&#20934;filter&#24314;&#31435;&#20102;&#23545;web&#35831;&#27714;&#30340;&#29615;&#32469;advice&#12290;</p>

      <p>&#23545;&#37027;&#20123;&#19981;&#29087;&#24713;AOP&#30340;&#20154;&#65292;&#38656;&#35201;&#29702;&#35299;&#30340;&#20851;&#38190;&#38382;&#39064;&#26159;Spring Security&#21487;&#20197;&#24110;&#21161;&#20320;&#20445;&#25252;&#26041;&#27861;&#30340;&#35843;&#29992;&#65292;&#23601;&#20687;&#20445;&#25252;web&#35831;&#27714;&#19968;&#26679;&#12290;
      &#22823;&#22810;&#25968;&#20154;&#23545;&#20445;&#25252;&#26381;&#21153;&#23618;&#37324;&#30340;&#23433;&#20840;&#26041;&#27861;&#38750;&#24120;&#25353;&#20852;&#36259;&#12290;
      &#36825;&#26159;&#22240;&#20026;&#22312;&#30446;&#21069;&#36825;&#19968;&#20195;J2EE&#31243;&#24207;&#37324;&#65292;&#26381;&#21153;&#22120;&#25918;&#20102;&#26356;&#22810;&#19994;&#21153;&#30456;&#20851;&#30340;&#36923;&#36753;&#65288;&#38656;&#35201;&#28548;&#28165;&#65292;&#20316;&#32773;&#19981;&#24314;&#35758;&#36825;&#31181;&#35774;&#35745;&#26041;&#27861;&#65292;&#20316;&#20026;&#26367;&#20195;&#30340;&#65292;&#32780;&#26159;&#24212;&#35813;&#20351;&#29992;DTO&#65292;&#38598;&#20250;&#65292;&#38376;&#38754;&#21644;&#36879;&#26126;&#25345;&#20037;&#27169;&#24335;&#21387;&#32553;&#39046;&#22495;&#23545;&#35937;&#65292;&#20294;&#26159;&#20351;&#29992;&#36139;&#34880;&#39046;&#22495;&#23545;&#35937;&#26159;&#24403;&#21069;&#30340;&#20027;&#27969;&#24605;&#36335;&#65292;&#25152;&#20197;&#25105;&#20204;&#36824;&#26159;&#20250;&#22312;&#36825;&#37324;&#35752;&#35770;&#23427;&#65289;&#12290;
      &#22914;&#26524;&#20320;&#21482;&#26159;&#38656;&#35201;&#20445;&#25252;&#26381;&#21153;&#23618;&#30340;&#26041;&#27861;&#35843;&#29992;&#65292;Spring&#26631;&#20934;AOP&#24179;&#21488;&#65288;&#19968;&#33324;&#34987;&#31216;&#20316;AOP&#32852;&#30431;&#65289;&#23601;&#22815;&#20102;&#12290;
      &#22914;&#26524;&#20320;&#24819;&#30452;&#25509;&#20445;&#25252;&#39046;&#22495;&#23545;&#35937;&#65292;&#20320;&#20250;&#21457;&#29616;AspectJ&#38750;&#24120;&#20540;&#24471;&#32771;&#34385;&#12290;</p>

      <p>&#21487;&#20197;&#36873;&#25321;&#20351;&#29992;AspectJ&#36824;&#26159;Spring AOP&#22788;&#29702;&#26041;&#27861;&#39564;&#35777;&#65292;&#25110;&#32773;&#20320;&#21487;&#20197;&#36873;&#25321;&#20351;&#29992;filter&#22788;&#29702;web&#35831;&#27714;&#39564;&#35777;&#12290;
      &#20320;&#21487;&#20197;&#19981;&#36873;&#65292;&#36873;&#25321;&#20854;&#20013;&#19968;&#20010;&#65292;&#36873;&#25321;&#20004;&#20010;&#65292;&#25110;&#32773;&#19977;&#20010;&#37117;&#36873;&#12290;
      &#20027;&#27969;&#30340;&#24212;&#29992;&#26159;&#22788;&#29702;&#19968;&#20123;web&#35831;&#27714;&#39564;&#35777;&#65292;&#20877;&#32467;&#21512;&#19968;&#20123;&#22312;&#26381;&#21153;&#23618;&#37324;&#30340;Spring AOP&#26041;&#27861;&#35843;&#29992;&#39564;&#35777;&#12290;</p>
    </div>

    <div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d4e774"></a>5.4.2.&nbsp;AbstractSecurityInterceptor</h3></div></div></div>
      

      <p>Spring Security&#25903;&#25345;&#30340;&#27599;&#20010;&#23433;&#20840;&#23545;&#35937;&#31867;&#22411;&#37117;&#26377;&#23427;&#33258;&#24049;&#30340;&#31867;&#22411;&#65292;&#23427;&#20204;&#37117;&#26159;<code class="literal">AbstractSecurityInterceptor</code>&#30340;&#23376;&#31867;&#12290;
      &#24456;&#37325;&#35201;&#30340;&#26159;&#65292;&#22914;&#26524;&#20027;&#20307;&#26159;&#24050;&#32463;&#36890;&#36807;&#20102;&#39564;&#35777;&#65292;&#22312;<code class="literal">AbstractSecurityInterceptor</code>&#34987;&#35843;&#29992;&#30340;&#26102;&#20505;&#65292;<code class="literal">SecurityContextHolder</code>&#23558;&#20250;&#21253;&#21547;&#19968;&#20010;&#26377;&#25928;&#30340;<code class="literal">Authentication</code>&#12290;</p>

      <p><code class="literal">AbstractSecurityInterceptor</code>&#25552;&#20379;&#20102;&#19968;&#22871;&#19968;&#33268;&#30340;&#24037;&#20316;&#27969;&#31243;&#65292;&#26469;&#22788;&#29702;&#23545;&#23433;&#20840;&#23545;&#35937;&#30340;&#35831;&#27714;&#65292;&#36890;&#24120;&#26159;&#65306;

        </p><div class="orderedlist"><ol type="1"><li><p>&#26597;&#25214;&#24403;&#21069;&#35831;&#27714;&#37324;&#20998;&#37197;&#30340;"&#37197;&#32622;&#23646;&#24615;"&#12290;</p></li><li><p>&#25226;&#23433;&#20840;&#23545;&#35937;&#65292;&#24403;&#21069;&#30340;<code class="literal">Authentication</code>&#21644;&#37197;&#32622;&#23646;&#24615;&#65292;&#25552;&#20132;&#32473;<code class="literal">AccessDecisionManager</code>&#65292;&#26469;&#36827;&#34892;&#20197;&#27492;&#35748;&#35777;&#20915;&#23450;&#12290;</p></li><li><p>&#26377;&#21487;&#33021;&#22312;&#35843;&#29992;&#30340;&#36807;&#31243;&#20013;&#65292;&#23545; <code class="literal">Authentication</code> &#36827;&#34892;&#20462;&#25913;&#12290;</p></li><li><p>&#20801;&#35768;&#23433;&#20840;&#23545;&#35937;&#36827;&#34892;&#22788;&#29702;&#65288;&#20551;&#35774;&#35775;&#38382;&#34987;&#20801;&#35768;&#20102;&#65289;&#12290;</p></li><li><p>&#22312;&#35843;&#29992;&#36820;&#22238;&#30340;&#26102;&#20505;&#25191;&#34892;&#37197;&#32622;&#30340;<code class="literal">AfterInvocationManager</code>&#12290;</p></li></ol></div><p>
      </p>

      <div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d4e798"></a>5.4.2.1.&nbsp;&#37197;&#32622;&#23646;&#24615;&#26159;&#20160;&#20040;&#65311;</h4></div></div></div>
        
        <p>
          &#19968;&#20010;"&#37197;&#32622;&#23646;&#24615;"&#21487;&#20197;&#30475;&#20570;&#26159;&#19968;&#20010;&#23383;&#31526;&#20018;&#65292;&#23427;&#23545;&#20110;<code class="literal">AbstractSecurityInterceptor</code>&#20351;&#29992;&#30340;&#31867;&#26159;&#26377;&#29305;&#27530;&#21547;&#20041;&#30340;&#12290;&#23427;&#20204;&#21487;&#33021;&#26159;&#31616;&#21333;&#30340;&#35282;&#33394;&#21517;&#31216;&#25110;&#25317;&#26377;&#26356;&#22797;&#26434;&#30340;&#21547;&#20041;&#65292;&#36825;&#23601;&#19982;<code class="literal">AccessDecisionManager</code>&#23454;&#29616;&#30340;&#20808;&#36827;&#31243;&#24230;&#26377;&#20851;&#20102;&#12290;
          <code class="literal">AbstractSecurityInterceptor</code>&#21644;&#37197;&#32622;&#22312;&#19968;&#36215;&#30340;<code class="literal">ObjectDefinitionSource</code>&#29992;&#26469;&#20026;&#19968;&#20010;&#23433;&#20840;&#23545;&#35937;&#25628;&#32034;&#23646;&#24615;&#12290;
          &#36890;&#24120;&#36825;&#20010;&#23646;&#24615;&#23545;&#29992;&#25143;&#26159;&#19981;&#21487;&#35265;&#30340;&#12290;
          &#37197;&#32622;&#23646;&#24615;&#23558;&#20197;&#27880;&#35299;&#30340;&#26041;&#24335;&#35774;&#32622;&#22312;&#21463;&#20445;&#25252;&#26041;&#27861;&#19978;&#65292;&#25110;&#32773;&#20316;&#20026;&#21463;&#20445;&#25252;URL&#30340;&#35775;&#38382;&#23646;&#24615;&#65288;&#20351;&#29992;&#21629;&#21517;&#31354;&#38388;&#37324;&#30340;<code class="literal">&lt;intercept-url&gt;</code>&#35821;&#27861;&#65289;&#12290;
        </p>
      </div>

      <div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d4e806"></a>5.4.2.2.&nbsp;RunAsManager</h4></div></div></div>
        

        <p>&#20551;&#35774;<code class="literal">AccessDecisionManager</code>&#20915;&#23450;&#20801;&#35768;&#25191;&#34892;&#36825;&#20010;&#35831;&#27714;&#65292;<code class="literal">AbstractSecurityInterceptor</code>&#20250;&#27491;&#24120;&#25191;&#34892;&#36825;&#20010;&#35831;&#27714;&#12290;
        &#35805;&#34429;&#22914;&#27492;&#65292;&#32597;&#35265;&#24773;&#20917;&#19979;&#65292;&#29992;&#25143;&#21487;&#33021;&#38656;&#35201;&#25226;<code class="literal">SecurityContext</code>&#30340;<code class="literal">Authentication</code>&#25442;&#25104;&#21478;&#19968;&#20010;<code class="literal">Authentication</code>&#65292;&#36890;&#36807;&#35775;&#38382;<code class="literal">RunAsManager</code>&#12290;
        &#36825;&#20063;&#35768;&#22312;&#65292;&#26377;&#21407;&#22240;&#65292;&#19981;&#24120;&#35265;&#30340;&#24773;&#20917;&#19979;&#26377;&#29992;&#65292;&#27604;&#22914;&#65292;&#26381;&#21153;&#23618;&#26041;&#27861;&#38656;&#35201;&#35843;&#29992;&#36828;&#31243;&#31995;&#32479;&#65292;&#34920;&#29616;&#19981;&#21516;&#30340;&#36523;&#20221;&#12290;
        &#22240;&#20026;Spring Security&#33258;&#21160;&#20256;&#25773;&#23433;&#20840;&#36523;&#20221;&#65292;&#20174;&#19968;&#20010;&#26381;&#21153;&#22120;&#21040;&#21478;&#19968;&#20010;&#65288;&#20551;&#35774;&#20320;&#20351;&#29992;&#20102;&#37197;&#32622;&#22909;&#30340;RMI&#25110;&#32773;HttpInvoker&#36828;&#31243;&#35843;&#29992;&#21327;&#35758;&#23458;&#25143;&#31471;&#65289;&#65292;&#23601;&#21487;&#20197;&#29992;&#21040;&#23427;&#20102;&#12290;</p>
      </div>

      <div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d4e815"></a>5.4.2.3.&nbsp;AfterInvocationManager</h4></div></div></div>
        
        <p>&#25353;&#29031;&#19979;&#38754;&#23433;&#20840;&#23545;&#35937;&#25191;&#34892;&#21644;&#36820;&#22238;&#30340;&#26041;&#24335;-&#21487;&#33021;&#24847;&#21619;&#30528;&#23436;&#20840;&#30340;&#26041;&#27861;&#35843;&#29992;&#25110;&#36807;&#28388;&#22120;&#38142;&#30340;&#25191;&#34892;&#12290;
        &#36825;&#31181;&#29366;&#24577;&#19979;<code class="literal">AbstractSecurityInterceptor</code>&#23545;&#26377;&#21487;&#33021;&#20462;&#25913;&#36820;&#22238;&#23545;&#35937;&#24863;&#20852;&#36259;&#12290;
        &#20320;&#21487;&#33021;&#24819;&#35753;&#23427;&#21457;&#29983;&#65292;&#22240;&#20026;&#39564;&#35777;&#20915;&#23450;&#19981;&#33021;&#8220;&#20851;&#20110;&#22914;&#20309;&#22312;&#8221;&#19968;&#20010;&#23433;&#20840;&#23545;&#35937;&#35843;&#29992;&#12290;
        &#39640;&#21487;&#25554;&#25300;&#24615;&#65292;<code class="literal">AbstractSecurityInterceptor</code>&#36890;&#36807;&#25511;&#21046;<code class="literal">AfterInvocationManager</code>&#65292;&#23454;&#38469;&#19978;&#22312;&#38656;&#35201;&#30340;&#26102;&#20505;&#65292;&#20462;&#25913;&#23545;&#35937;&#12290;
        &#36825;&#37324;&#31867;&#23454;&#38469;&#19978;&#21487;&#33021;&#26367;&#25442;&#23545;&#35937;&#65292;&#25110;&#32773;&#25243;&#20986;&#24322;&#24120;&#65292;&#25110;&#32773;&#20160;&#20040;&#20063;&#19981;&#20570;&#12290;</p>

        <p><code class="literal">AbstractSecurityInterceptor</code>&#21644;&#30456;&#20851;&#23545;&#35937;&#23637;&#31034;&#22312; <a href="technical-overview.html#abstract-security-interceptor" tppabs="http://www.family168.com/tutorial/springsecurity/html/technical-overview.html#abstract-security-interceptor" title="Figure&nbsp;5.1.&nbsp;&#20851;&#38190;&#34;secure object&#34;&#27169;&#22411;">Figure&nbsp;5.1, &#8220;&#20851;&#38190;"secure object"&#27169;&#22411;&#8221;</a>&#20013;&#12290;

          </p><div class="figure"><a name="abstract-security-interceptor"></a><div class="figure-contents">
            
            <div class="mediaobject" align="center"><img src="SecurityInterception.gif" tppabs="http://www.family168.com/tutorial/springsecurity/html/images/SecurityInterception.gif" align="middle" alt="&#20851;&#38190;&#34;secure object&#34;&#27169;&#22411;"></div>
          </div><p class="title"><b>Figure&nbsp;5.1.&nbsp;&#20851;&#38190;"secure object"&#27169;&#22411;</b></p></div><p><br class="figure-break">
        </p>
      </div>

      <div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d4e831"></a>5.4.2.4.&nbsp;&#25193;&#23637;&#23433;&#20840;&#23545;&#35937;&#27169;&#22411;</h4></div></div></div>
        
        <p>&#21482;&#26377;&#24320;&#21457;&#32773;&#25165;&#20250;&#20851;&#24515;&#20351;&#29992;&#20840;&#24515;&#30340;&#26041;&#27861;&#65292;&#36827;&#34892;&#25318;&#25130;&#21644;&#39564;&#35777;&#35831;&#27714;&#65292;&#23558;&#30452;&#25509;&#20351;&#29992;&#23433;&#20840;&#26041;&#27861;&#12290;
        &#27604;&#22914;&#65292;&#21487;&#33021;&#26032;&#24314;&#19968;&#20010;&#23433;&#20840;&#26041;&#27861;&#65292;&#25511;&#21046;&#23545;&#28040;&#24687;&#31995;&#32479;&#30340;&#26435;&#38480;&#12290;
        &#23433;&#20840;&#38656;&#35201;&#30340;&#20219;&#20309;&#20107;&#24773;&#65292;&#20063;&#21487;&#20197;&#25552;&#20379;&#19968;&#31181;&#25318;&#25130;&#30340;&#26041;&#27861;&#65288;&#22909;&#20687;AOP&#30340;&#29615;&#32469;advice&#35821;&#27861;&#37027;&#26679;&#65289;&#26377;&#21487;&#33021;&#22312;&#23433;&#20840;&#23545;&#35937;&#37324;&#22788;&#29702;&#12290;
        &#36825;&#26679;&#35828;&#30340;&#35805;&#65292;&#22823;&#22810;&#25968;Spring&#24212;&#29992;&#31616;&#21333;&#25317;&#26377;&#19977;&#31181;&#24403;&#21069;&#25903;&#25345;&#30340;&#23433;&#20840;&#31867;&#22411;&#65288;AOP&#32852;&#30431;&#30340;<code class="literal">MethodInvocation</code>&#65292;AspectJ <code class="literal">JoinPoint</code>&#21644;web&#35831;&#27714;<code class="literal">FilterInterceptor</code>&#65289;&#23436;&#20840;&#36879;&#26126;&#30340;&#12290;</p>
      </div>
    </div>
  </div>
</div><div xmlns:fo="http://www.w3.org/1999/XSL/Format" class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="overall-architecture.html" tppabs="http://www.family168.com/tutorial/springsecurity/html/overall-architecture.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="springsecurity.html" tppabs="http://www.family168.com/tutorial/springsecurity/html/springsecurity.html">Home</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="supporting-infrastructure.html" tppabs="http://www.family168.com/tutorial/springsecurity/html/supporting-infrastructure.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Part&nbsp;II.&nbsp;&#24635;&#20307;&#32467;&#26500;&nbsp;</td><td width="20%" align="center"><span style="color:white;font-size:90%;"><a href="javascript:if(confirm('http://www.springsource.com/  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://www.springsource.com/'" tppabs="http://www.springsource.com/" title="SpringSource">Sponsored by SpringSource
                                        </a></span></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;6.&nbsp;&#25903;&#25345;&#30340;&#22522;&#30784;&#35774;&#26045;</td></tr></table></div></body></html><script type="text/javascript">var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www./");document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));</script><script type="text/javascript">var pageTracker = _gat._getTracker("UA-2857097-3");pageTracker._initData();pageTracker._trackPageview();</script>